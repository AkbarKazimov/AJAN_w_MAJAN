# @base <http://localhost:8090/rdf4j/repositories/behaviors#> .

@prefix agents: <http://localhost:8090/rdf4j/repositories/agents#> .
@prefix : <http://localhost:8090/rdf4j/repositories/behaviors#> .
@prefix domain: <http://localhost:8090/rdf4j/repositories/domain#> .
@prefix localServices: <http://localhost:8090/rdf4j/repositories/localServices#> .
@prefix localAgents: <http://localhost:8090/rdf4j/repositories/localAgents#> .
@prefix services: <http://localhost:8090/rdf4j/repositories/services#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix ajan: <http://www.ajan.de/ajan-ns#> .
@prefix bt: <http://www.ajan.de/behavior/bt-ns#> .
@prefix actn: <http://www.ajan.de/actn#> .
@prefix http-headers: <http://www.w3.org/2008/http-headers#> .
@prefix http-methods: <http://www.w3.org/2008/http-methods#> .
@prefix http-core: <http://www.w3.org/2006/http#> .
@prefix ssc: <http://welcome/ajan/servicecomputing#> .
@prefix welcomePlugin: <http://welcome/ajan/plugin#> .

# ----------------------------------------------
# ------------- WelcomeBehaviorTree ------------
# ----------------------------------------------

# ----------- Endpoint ------------

# localhost:8080/welcome/integration/coordination/ajan/agents/<agentName>?capability=receiveSpeechAct | POST | text/turtle
# Body: "<http://test/Subject> <http://test/predicate> "Hallo! I come from the KMS" ."
# localhost:8080/welcome/integration/coordination/ajan/agents/<agentName>?capability=populateRepo | POST | text/turtle
# Body: "<http://test/Subject> <http://test/predicate> "Hallo! I come from the WPM" ."

# -------------------------------------------	
# ---------------- Behaviors ----------------
# -------------------------------------------	

#------------MAJAN Stuff----------------------

:LCCProtocolBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "LCC Protocol Behavior Tree" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										#:CoalitionGenerator
										#:CSGPSolver
										#:ConditionLSRPopulated
										:TestBigQuery
									)
				] .

:CHCProtocolBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "CHC Protocol Behavior Tree" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
							:HandleCHCProtocolEvent
							[
								a bt:Priority ;	
								bt:hasChildren (
										[
											a bt:Sequence ;
											bt:hasChildren (
													:ConditionAgentRunningCHCProcess
													:MessageAlreadyRunningCHCProcess
													)																														
										]
										[
											a bt:Sequence ;
											bt:hasChildren (
													:ConditionAgentInvolvedInCHCProcess
													[
														a bt:Priority ;
														bt:hasChildren (
																[
																	a bt:Invert ;
																	bt:hasChild 
																			:MessageWantToStartNewCHCProcess
																]
																[
																	a bt:Invert ;
																	bt:hasChild 
																			:ConditionStillWantToStartCHC
																]
																
																)																														
													]
													)																														
										]
										:EventProducerExecuteCHCProcessEvent
								)																														
							]				
		
							)
				] .

:ExecutingCHCProcessBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "ExecutingCHCProcessBT Behavior Tree" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										:HDBSCAN
									)
				] .

:SharingCHCPersonalInfoBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "SharingCHCPersonalInfoBT Behavior Tree" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										:HDBSCAN
									)
				] .

:ReceiveCHCPersonalInfoBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "ReceiveCHCPersonalInfoBT Behavior Tree" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										:HDBSCAN
									)
				] .

:SharingCHCSimilaritiesBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "SharingCHCSimilaritiesBT Behavior Tree" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										:HDBSCAN
									)
				] .

:ReceivingCHCSimilaritiesBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "ReceivingCHCSimilaritiesBT Behavior Tree" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										:HDBSCAN
									)
				] .

:SolvingCHCBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "SolvingCHCBT Behavior Tree" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										:HDBSCAN
									)
				] .

:SharingCHCResultBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "SharingCHCResultBT Behavior Tree" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										:HDBSCAN
									)
				] .



#---------------MAJAN BT Nodes---------------

:HandleCHCProtocolEvent
	a bt:HandleEvent ;
	rdfs:label "EventHandler: CHC Protocol BT" ;
	bt:event agents:CHCProtocolEvent ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:AgentKnowledge ;
					bt:sparql """
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							?s ?p ?o .
						}
						WHERE { 
							?s ?p ?o .				
						}"""^^xsd:string ;
				] .

:ConditionAgentRunningCHCProcess
	a bt:Condition ;
	rdfs:label "Condition: Is Agent Running a CHC Process as Dedicated Agent?" ;
	bt:query ( [
		a bt:AskQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					ASK
					WHERE {
						?s ?p ?o.	
						?s ajan:sik ajan:bas.
					}"""^^xsd:string ;
		]) .

:ConditionAgentInvolvedInCHCProcess
	a bt:Condition ;
	rdfs:label "Condition: Is agent involved in a CHC process?" ;
	bt:query ( [
		a bt:AskQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					ASK
					WHERE {
						?s ?p ?o.	
					}"""^^xsd:string ;
		]) .
		
:ConditionStillWantToStartCHC
	a bt:Condition ;
	rdfs:label "Condition: Does TCN want to start a CHC even though he/she is already involved in one?" ;
	bt:query ( [
		a bt:AskQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					ASK
					WHERE {
						?s ?p ?o.	
					}"""^^xsd:string ;
		]) .
		
		
:MessageAlreadyRunningCHCProcess
	a bt:Message ;
	rdfs:label "Message: Send Already running a CHC Process to TCN"^^xsd:string ;
	rdfs:comment "Message: Send Already running a CHC Process to TCN"^^xsd:string ;
	bt:targetBase ajan:AgentKnowledge ;  
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
			a bt:SelectQuery;
			a bt:QueryUri ;
			bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?hdrName ?userID
				WHERE {
					   VALUES ?hdrName {"X-User-ID"}
					   ?du rdf:type welcome:DialogueUser .
					   ?du welcome:hasUserId ?userID .
				}"""^^xsd:string
		] ;
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "application/ld+json; charset=UTF-8"^^xsd:string 
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "application/ld+json"
				][
					a http-core:Header ;
					http-core:hdrName http-headers:to ;
					http-core:fieldValue "APP"
			]
		) ;	
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:AgentKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							?s ?p ?o .
						}
						WHERE {
							?s ?p ?o .
						}"""^^xsd:string
			]
		] ;    
	] ;
	bt:queryUri [
		a bt:SelectQuery ;
		a bt:QueryUri ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					SELECT ?requestURI
					WHERE {
					  VALUES ?requestURI { "http://localhost:8092/informApp" }
					}"""^^xsd:string
	] .
	
	
:MessageWantToStartNewCHCProcess
	a bt:Message ;
	rdfs:label "Message: Send already involved in a CHC process. Still want to start a new one? to TCN"^^xsd:string ;
	rdfs:comment "Message: Send already involved in a CHC process. Still want to start a new one? to TCN"^^xsd:string ;
	bt:targetBase ajan:AgentKnowledge ;  
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
			a bt:SelectQuery;
			a bt:QueryUri ;
			bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?hdrName ?userID
				WHERE {
					   VALUES ?hdrName {"X-User-ID"}
					   ?du rdf:type welcome:DialogueUser .
					   ?du welcome:hasUserId ?userID .
				}"""^^xsd:string
		] ;
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "application/ld+json"^^xsd:string 
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "application/ld+json"
				][
					a http-core:Header ;
					http-core:hdrName http-headers:to ;
					http-core:fieldValue "APP"
			]
		) ;	
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:AgentKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							?s ?p ?o .
						}
						WHERE {
							?s ?p ?o .
						}"""^^xsd:string
			]
		] ;    
	] ;
	bt:queryUri [
		a bt:SelectQuery ;
		a bt:QueryUri ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					SELECT ?requestURI
					WHERE {
					  VALUES ?requestURI { "http://localhost:8092/askApp" }
					}"""^^xsd:string
	] .
	
	
:EventProducerExecuteCHCProcessEvent
	a bt:EventProducer ;
	rdfs:label "EventProducer: Execute CHC Process" ;
	ajan:event agents:ExecuteCHCProcessEvent ;
	bt:content [
					a bt:ConstructQuery ;
					bt:originBase ajan:AgentKnowledge;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							?s ?p ?o .
						}
						WHERE {
							?s ?p ?o .
						}"""^^xsd:string ;
				] .	
	
#------------MAJAN Stuff----------------------

:InitialWelcomeBehavior
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "Initialization Behavior" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										:UpdateBehaviorRunning
										[
											a bt:Priority ;
											bt:hasChildren (
																:ConditionLSRPopulated
																:EventProducerPopulateLSR
															)																														
										]
										[
											a bt:Priority ;
											bt:hasChildren (
																:ConditionLARPopulated
																:EventProducerPopulateLAR														
															)																														
										]
									)
				] .

:FinalWelcomeBehavior
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "Final Behavior" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										:DeleteTemporalFlagsinLAKR
										:DeleteTemporalFlagsinLSR
									)
				] .

:HeartbeatMonitoringBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "Heartbeat behavior" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										:AgentMonitoringHandleEvent
									)
				] .



:SendRequestPopulateRepos
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "Populate Local Repositories" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										[
											a bt:Priority ;
											bt:hasChildren (
																[
																	a bt:Invert ;
																	bt:hasChild 
																				:EventHandlerRequestLSRTriples																													
																]
																[
																	a bt:Sequence ;
																	bt:hasChildren (
																						:UpdateBehaviorRunning
																						:ActionSendLSRMessageWPM
																					)																															
																]
															)																															
										]
										[
											a bt:Priority ;
											bt:hasChildren (
																[
																	a bt:Invert ;
																	bt:hasChild 
																				:EventHandlerRequestLARTriples																													
																]
																[
																	a bt:Sequence ;
																	bt:hasChildren (
																						:UpdateBehaviorRunning
																						:ActionSendLARMessageWPM
																					)																															
																]
															)																															
										]										
									)				

				] .

:ReceiveTriplestoLocalRepos
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "Receive Triples Local Repos" ;
	bt:hasChild [
	a bt:Priority ;
	bt:hasChildren (
						[
							a bt:Sequence ;
							bt:hasChildren (
												:EventHandlerReceiveLocalAgents
												:UpdateBehaviorRunning
												[
													a bt:Priority ;
													bt:hasChildren (
																		[
																			a bt:Invert ;
																			bt:hasChild 
																						:ConditionLARPopulated																														
																		]
																		:RemoveLARContent
																		:UpdateLARAgentKnowledge
																	)																															
												]
												:WriteTriplesLAR
												:UpdateAgentKnowsLAR
												:UpdateLARExecutionKnowledge
												:UpdateDeleteBehaviorRunning
											)																															
						]
						[
							a bt:Sequence ;
							bt:hasChildren (
												:EventHandlerReceiveLocalServices
												:UpdateBehaviorRunning
												[
													a bt:Priority ;
													bt:hasChildren (
																		[
																			a bt:Invert ;
																			bt:hasChild 
																					:ConditionLSRPopulated																														
																		]
																		:RemoveLSRContent
																		:UpdateLSRAgentKnowledge
																	)																															
												]
												:WriteTriplesLSRC1
												:WriteTriplesLSRC2
												:PluginOWL2PDDL
												:UpdateAgentKnowsLSR
												:UpdateLSRExecutionKnowledge
												:UpdateDeleteBehaviorRunning
											)																															
						]						
					)															
				] .
				
:HandshakeBehavior
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "Handhshake BT" ;
	bt:hasChild [
					a bt:Priority ;
					bt:hasChildren (
										[
											a bt:Invert ;
											bt:hasChild 
														:EventHandlerHandshake
										]
										[
											a bt:Sequence ;
											bt:hasChildren (
																:UpdateBehaviorRunning
																:ConditionLSRPopulated
																[
																	a bt:Priority ;
																	bt:hasChildren ([
																						a bt:Sequence ;
																						bt:hasChildren (
																										:ConditionLARPopulated																										
																										:UpdateCreateHeaderReadinessMessage
																										:MessageSendAgentReadiness
																										:UpdateDeleteBehaviorRunning
																										:DeleteHeaderReadinessMessageinLAKR
																										)																															
																					]
																					:EventProducerPopulateLAR
																					)																												
																]
															)
										]
										:EventProducerPopulateLSR									
									)																														
	] .
			
:ProcessSpeechActsBehavior
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "Process Speech Acts BT" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										[
											a bt:Priority ;
											bt:hasChildren (
																[
																	a bt:Invert ;
																	bt:hasChild 
																				:EventSpeaktoavatar
																]
																[
																	a bt:Sequence ;
																	bt:hasChildren (
																						:UpdateBehaviorRunning
																						:WriteAgentNameinExecution
																						:UpdateCreateOpeningDIPPart1
																						:UpdateCreateOpeningDIPPart2
																						:UpdateCreateOpeningDIPPart3
																						:SendDIPtoKMS
																						:UpdateExecutionDeleteDIP
																					)
																]
															)																														
										]
										[
											a bt:Priority ;
											bt:hasChildren (
																[
																	a bt:Invert ;
																	bt:hasChild 
																				:EventDIP_OR_ServiceRequest
																]
																[
																	a bt:Priority ;
																	bt:hasChildren (
																						[
																							a bt:Priority ;
																							bt:hasChildren (
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:UpdateBehaviorRunning																																		
																																		[
																																			a bt:IsSucceeding ;
																																			bt:hasChild 	
																																						:DeletePreviousDIPinExecution
																																						
																																		]
																																		:WriteActiveDIPinExecution
																																		:ConditionDIPIncomplete
																																		:UpdateIncompleteDIP
																																		:EventProducerSpecificBTDIPIncomplete
																																	)
																												]
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionDIPComplete
																																		:UpdateCompleteDIP
																																		[
																																			a bt:Priority ;
																																			bt:hasChildren (
																																								[
																																									a bt:Sequence ;
																																									bt:hasChildren (
																																														:ConditionDIPIsNotOpening
																																														:EventProducerSpecificBTDIPComplete
																																													)
																																								]
																																								[
																																									a bt:Sequence ;
																																									bt:hasChildren (
																																														:ConditionalNoServiceRequest
																																														:DeleteActiveDIPinAgentKB
																																														:WriteAgentNameinExecution
																																														[
																																															a bt:IsSucceeding ;
																																															bt:hasChild 	
																																																		:DeletePreviousDIPinExecution
																																														]
																																														:CreateClosingUponFailureNoRequest
																																														:SendDIPtoKMS
																																													)
																																								]
																																							)
																																		]
																																	)
																												]
																											)
																						]
																						[
																							a bt:Priority ;
																							bt:hasChildren (
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionServiceRequest
																																		[
																																			a bt:IsSucceeding ;
																																			bt:hasChild 	
																																					:DeletePreviousServiceRequestinExecution
																																		]																																		
																																		:WriteServiceRequestinExecution
																																		[
																																			a bt:Priority ;
																																			bt:hasChildren (
																																								[
																																									a bt:Sequence ;
																																									bt:hasChildren (
																																														:InvokeMatchmaker
																																														:ConditionMatchmakerOutput
																																														:PDDL2SPARQLPlugin
																																														[
																																															a bt:Priority ;
																																															bt:hasChildren (
																																																				[
																																																					a bt:Sequence ;
																																																					bt:hasChildren (
																																																										:ConditionPreconditionHolds	
																																																										[
																																																											a bt:Priority ;
																																																											bt:hasChildren (
																																																																[
																																																																	a bt:Sequence ;
																																																																	bt:hasChildren (
																																																																						:ConditionAtomicService
																																																																						:CreateAtomicServiceDIP
																																																																					)																														
																																																																]	
																																																																[
																																																																	a bt:Sequence ;
																																																																	bt:hasChildren (
																																																																						:ConditionComposedService
																																																																						:CreateComposedServiceDIP
																																																																					)																														
																																																																]	
																																																															)																														
																																																										]																						
																																																										:WriteSSCResultinAgentKB
																																																										:EventProducerFirstInteractionMove
																																																									)																														
																																																				]
																																																				:EventProducerAlternativeFirstInteractionMove																																		
																																																			)																														
																																														]
																																													)
																																								]																					
																																								[
																																									a bt:Sequence ;
																																									bt:hasChildren (
																																														:InvokePlanner
																																														:ConditionPlannerOutput
																																														:SendPlanDIPKMS	
																																													)																														
																																								]
																																							)
																																		]
																																	)																														
																												]
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:WriteAgentNameinExecution
																																		:DeleteActiveDIPinAgentKB
																																		[
																																			a bt:IsSucceeding ;
																																			bt:hasChild 	
																																						:DeletePreviousDIPinExecution
																																		]
																																		:CreateClosingUponFailureNoRequest
																																		:SendDIPtoKMS
																																	)																														
																												]																					
																											)																														
																						]
																					)
																]
															)																														
										]										
										[
											a bt:Priority ;
											bt:hasChildren (
																[
																	a bt:Invert ;
																	bt:hasChild 
																				:EventDefaultStatementNoOpinion
																]
																[
																	a bt:Sequence ;
																	bt:hasChildren (
																						:UpdateBehaviorRunning
																						:DeleteActiveDIPinAgentKB
																						:WriteAgentNameinExecution
																						[
																							a bt:IsSucceeding ;
																							bt:hasChild 	
																										:DeletePreviousDIPinExecution
																						]
																						:CreateClosingUponFailureInternalError
																						:SendDIPtoKMS
																					)
																]
															)																														
										]
									)
				] .

:SpecificFirstReceptionBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "Specific First Reception Behavior Tree" ;
	bt:hasChild [
		a bt:Priority ;
		bt:hasChildren (							
							[
								a bt:Sequence ;
								bt:hasChildren (
													:EventHandlerGenericFirstInteractionMove
													:UpdateBehaviorRunning
													:DeletePrecondition
													[
														a bt:IsSucceeding ;
														bt:hasChild 	
																	:DeleteActiveDIPinExecution
													]
													:WriteFirstInteractionFlaginExecution
													:DeleteFirstInteractionFlaginLAKR
													:DeleteActiveDIPinAgentKB
													[
														a bt:Priority ;
														bt:hasChildren (
																			[
																				a bt:Sequence ;
																				bt:hasChildren (
																									:ConditionalServiceFirstInteraction
																									:WriteObtainRegistrationStatus2Execution
																									:DeleteObtainRegistrationStatusinLAKR
																									:SendDIPtoKMS
																								)																														
																			]
																			[
																				a bt:Sequence ;
																				bt:hasChildren (
																									:WriteAgentNameinExecution
																									:DeletePreviousDIPinExecution
																									:UpdateCreateInformContactNGO																									
																									:SendDIPtoKMS
																								)																														
																			]																																		
																		)																														
													]
													:DeleteFirstInteractionFlaginExecution													
												)																														
							]
							[
								a bt:Sequence ;
								bt:hasChildren (
													:EventHandlerNormalClosingScenario													
													:UpdateBehaviorRunning
													:DeleteActiveDIPinExecution
													:DeleteActiveDIPinAgentKB													
													:UpdateCreateNormalClosing
													:SendDIPtoKMS
												)																														
							]
							[
								a bt:Priority ;
								bt:hasChildren (
													[
														a bt:Invert ;
														bt:hasChild [
																		a bt:Sequence ;
																		bt:hasChildren (
																					:EventHandlerSpecificBT
																					:UpdateBehaviorRunning
																					:DeletePreviousFlaginExecution
																					:WriteSpecificBTFlaginExecution
																					:DeleteSpecificBTFlag																					
																					[
																						a bt:IsSucceeding ;
																						bt:hasChild 	
																									:DeleteActiveDIPinExecution
																					]
																					:WriteActiveDIPinExecution
																					:DeleteActiveDIPinAgentKB																																				
																		)																														
																	]
													]
													[
														a bt:Priority ;
														bt:hasChildren (
																			[
																				a bt:Sequence ;
																				bt:hasChildren (
																									:ConditionalFlagIncomplete
																									:ConditionalDIPIncompleteOrMultiple
																									:UpdateCreateHeaderDMSMessage
																									:SendIncompleteOrMultipleDIPDMS
																									:DeleteHeaderDMSMessage
																									:UpdateDeleteBehaviorRunning
																								)																														
																			]			
																			[
																				a bt:Priority ;
																				bt:hasChildren (
																									[
																										a bt:Sequence ;
																										bt:hasChildren (
																															:ConditionalInformRegistrationServiceComplete
																															:EventProducerNormalClosingScenario
																														)																														
																									]
																									[
																										a bt:Sequence ;
																										bt:hasChildren (
																														:ConditionalFillFormCourseDIPComplete
																														:UpdateCreateHeaderAppNotificationMessage
																														:SendNotification2App
																														:DeleteHeaderAppNotificationMessage
																														)																														
																									]
																									[
																										a bt:Sequence ;
																										bt:hasChildren (
																															[
																																a bt:Priority ;
																																bt:hasChildren (
																																					[
																																						a bt:Sequence ;
																																						bt:hasChildren (
																																											:ConditionalObtainRegistrationStatusCompleteAndYesAnswer	
																																											:WriteProposeService2Execution																			
																																											:WriteSSCResultinExecution
																																											:UpdateProposeService
																																											:DeleteSSCResultinAgentKB
																																											:DeleteSSCResultinLSR
																																										)																														
																																					]
																																					[
																																						a bt:Sequence ;
																																						bt:hasChildren (
																																											:ConditionalObtainRegistrationStatusCompleteAndNotAnswer
																																											:WriteObtainRegistrationServiceInfo2Execution
																																										)																														
																																					]
																																					[
																																						a bt:Sequence ;
																																						bt:hasChildren (
																																											:ConditionalProposeServiceCompleteAndYes
																																											:WriteInformFirstReception2Execution
																																										)																														
																																					]
																																					[
																																						a bt:Sequence ;
																																						bt:hasChildren (
																																											:ConditionalProposeServiceCompleteAndNot
																																											:WriteAgentNameinExecution
																																											:UpdateCreateInformContactNGO	
																																										)																														
																																					]
																																					[
																																						a bt:Sequence ;
																																						bt:hasChildren (
																																											:ConditionalObtainRegistrationServiceInfoComplete
																																											:WriteInformRegistrationService2Execution
																																											:DeletePreviousRegistrationOfficesinExecution
																																											:WriteCoordinatesinExecution
																																											#:InvokeClosestDistancePlugin
																																											:UpdateInformRegistrationServiceDIP
																																										)																														
																																					]																															
																																					[
																																						a bt:Sequence ;
																																						bt:hasChildren (
																																											:ConditionalInformFirstReceptionServiceCompleteAndYesAnswer
																																											:WritePersonalInfoDIP2Execution
																																										)																														
																																					]							
																																					[
																																						a bt:Sequence ;
																																						bt:hasChildren (
																																											:ConditionalPersonalInfoComplete
																																											:WriteAddressInfoDIP2Execution
																																										)																														
																																					]
																																					[
																																						a bt:Sequence ;
																																						bt:hasChildren (
																																											:ConditionalAddressInfoDIPComplete
																																											:WriteFillFormOtherDIP2Execution
																																										)																														
																																					]
																																					[
																																						a bt:Sequence ;
																																						bt:hasChildren (
																																											:ConditionalFillFormOtherDIPComplete
																																											:WriteFillFormModulesDIP2Execution
																																										)																														
																																					]
																																					[
																																						a bt:Sequence ;
																																						bt:hasChildren (
																																											:ConditionalFillFormModulesDIPComplete
																																											:WriteFillFormCourseDIP2Execution
																																										)																														
																																					]
																																					[
																																						a bt:Sequence ;
																																						bt:hasChildren (
																																											:WriteAgentNameinExecution
																																											:CreateClosingUponFailureInternalError
																																										)																														
																																					]
																																				)																														
																															]
																															:SendDIPtoKMS
																														)																														
																									]
																								)
																			]																	
																		)																														
													]													
												)																														
							]
						)
				] .	
				
:AgentShutdown
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "Agent Shutdown Behavior Tree" ;
	bt:hasChild [
		a bt:Sequence ;
		bt:hasChildren (
							:EventHandlerShutdown
							[
								a bt:Priority ;
								bt:hasChildren (
													[
														a bt:Sequence ;
														bt:hasChildren (
																			:ConditionAgentRunningBT
																			:UpdateAgentRunningYes																			
																		)																														
													]
													:UpdateAgentRunningNot
												)																														
							]
							:MessageSendShutdownNotification
						)
				] .
			
# -------------------------------------------	
# ----------- Standard Primitives -----------
# -------------------------------------------	

#=============================================================================================
# InitialBT

:UpdateBehaviorRunning
	a bt:Update ;
	rdfs:label "Update: Write agentRunning Flag in the LAKR" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>									
					INSERT {
						?agent welcome:hasBTRunning "true"^^xsd:boolean .
					}
					 WHERE {
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .

:UpdateDeleteBehaviorRunning
	a bt:Update ;
	rdfs:label "Update: Delete agentRunning Flag in the LAKR" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>									
					DELETE {
						?agent welcome:hasBTRunning ?val .
					}
					 WHERE {
						?agent rdf:type ajan:Agent .
						?agent welcome:hasBTRunning ?val .
					}"""^^xsd:string ;
		]) .
		
:ConditionLARPopulated
	a bt:Condition ;
	rdfs:label "Condition: LAR initialized?" ;
	bt:query ( [
		a bt:AskQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					ASK
					WHERE {
						?agent rdf:type ajan:Agent .
						?agent welcome:knowsLocalAgents ?localAgents .	
					}"""^^xsd:string ;
		]) .

:EventProducerPopulateLAR
	a bt:EventProducer ;
	rdfs:label "EventProducer: Request Populate LAR" ;
	ajan:event agents:PopulateLAREvent ;
	bt:content [
					a bt:ConstructQuery ;
					bt:originBase ajan:AgentKnowledge;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							welcome:myWelcomeAgent welcome:needsPopulateLAR "localRepo" .
						}
						WHERE {
							?s rdf:type ajan:Agent .
						}"""^^xsd:string ;
				] .	

:ConditionLSRPopulated
	a bt:Condition ;
	rdfs:label "Condition: LSR initialized?" ;
	bt:query ( [
		a bt:AskQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					ASK
					WHERE {
						?agent rdf:type ajan:Agent .
						?agent welcome:knowsLocalServices ?localServices .	
					}"""^^xsd:string ;
		]) .
		
:EventProducerPopulateLSR
	a bt:EventProducer ;
	rdfs:label "EventProducer: Request Populate LSR" ;
	ajan:event agents:PopulateLSREvent ;
	bt:content [
					a bt:ConstructQuery ;
					bt:originBase ajan:AgentKnowledge;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							welcome:myWelcomeAgent welcome:needsPopulateLSR "localRepo" .
							<http://mycontext> <http://www.ajan.de/behavior/bt-ns#rdfContext> <http://localhost:8090/rdf4j/repositories/agents#PopulateLSREvent> .
						}
						WHERE {
							?s rdf:type ajan:Agent .
						}"""^^xsd:string ;
				] .	

#=============================================================================================
# FinalBT

:DeleteTemporalFlagsinLAKR
	a bt:Update ;
	rdfs:label "Update: Delete Flags in LAKR" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					DELETE {
						?MatchmakerOffer welcome:hasPrecondition ?precondition .
						?MatchmakerResult ssc:hasServiceName ?servName .	
						?agent welcome:hasBTRunning ?val .
						?query welcome:hasPreconditionResult ?preconVal .
						welcome:myWelcomeAgent welcome:hasFirstMove ?result .
						?bt welcome:hasActiveDIP ?id .	
						?dip welcome:hasNamedGraph ?dipGraph .
					}
					 WHERE {
						?s ?o ?p .
						OPTIONAL {
							{?MatchmakerOffer welcome:hasPrecondition ?precondition .}
							UNION
							{?MatchmakerResult ssc:hasServiceName ?servName .}	
							UNION
							{?agent welcome:hasBTRunning ?val .}
							UNION
							{?query welcome:hasPreconditionResult ?preconVal .}
							UNION
							{welcome:myWelcomeAgent welcome:hasFirstMove ?result .}
							UNION
							{?bt welcome:hasActiveDIP ?id .}
							UNION
							{?dip welcome:hasNamedGraph ?dipGraph .}
						}
					}					
					"""^^xsd:string ;
		]) .
		
:DeleteTemporalFlagsinLSR
	a bt:Update ;
	rdfs:label "Update: Delete Flags in LSR" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					DELETE {
						?ssc ssc:hasResultOffer ?MatchmakerOffer .	
					}
					WHERE {
						?s ?o ?p .
						OPTIONAL {
							?ssc ssc:hasResultOffer ?MatchmakerOffer .	
						}
					}					
					"""^^xsd:string ;
		]) .

#=============================================================================================
# HeartbeatMonitoringBT

:AgentMonitoringHandleEvent
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Heartbeat Monitoring" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#AgentMonitoringEvent> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:ExecutionKnowledge ;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>	
						CONSTRUCT {
							?s ?p ?o .
						}
						WHERE { 
							?s ?p ?o .				
						}"""^^xsd:string ;
				] .
				
#=============================================================================================
# PopulateReposBT
																
:EventHandlerRequestLSRTriples
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Request Populate LSR" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#PopulateLSREvent> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:AgentKnowledge ;
					bt:sparql """
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							welcome:myWelcomeAgent welcome:needsPopulateLSR "localRepo" .
						}
						WHERE { 
							welcome:myWelcomeAgent welcome:needsPopulateLSR "localRepo" .				
						}"""^^xsd:string ;
				] .

:ActionSendLSRMessageWPM
	a bt:Action ;
    rdfs:label "Action: Request KBS populate LSR" ;
    bt:inputs ( [
		a bt:Input ;
		a bt:ConstructQuery ;
        bt:originBase ajan:AgentKnowledge ;
        bt:sparql """
				PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				PREFIX ajan: <http://www.ajan.de/ajan-ns#>		
				CONSTRUCT {					
					?agent rdf:type ajan:Agent .
				}
				WHERE {
					?agent rdf:type ajan:Agent .
				}"""^^xsd:string ;
		]) ;
		bt:definition services:RetrieveWelcomeServices .
		
:EventHandlerRequestLARTriples
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Request Populate LAR" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#PopulateLAREvent> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:AgentKnowledge ;
					bt:sparql """						
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							welcome:myWelcomeAgent welcome:needsPopulateLAR "localRepo" .
						}
						WHERE { 
							welcome:myWelcomeAgent welcome:needsPopulateLAR "localRepo" .
						}"""^^xsd:string ;
				] .

:ActionSendLARMessageWPM
	a bt:Action ;
    rdfs:label "Action: Request KBS populate LAR" ;
    bt:inputs ([
		a bt:Input ;
		a bt:ConstructQuery ;
        bt:originBase ajan:AgentKnowledge ;
        bt:sparql """
				PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				PREFIX ajan: <http://www.ajan.de/ajan-ns#>		
				CONSTRUCT {					
					?agent rdf:type ajan:Agent .
				}
				WHERE {
					?agent rdf:type ajan:Agent .
				}"""^^xsd:string ;
		]) ;
	bt:definition services:RetrieveActiveAgents .

:EventHandlerReceiveLocalServices
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Receive Local Services" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#ReceiveLocalServicesEvent> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:ExecutionKnowledge ;
					bt:sparql """"""^^xsd:string ;
				] .

:RemoveLSRContent
	a bt:Update ;
	rdfs:label "Update: Remove LSR Content" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					DELETE {
						?s ?o ?p .
					}
					 WHERE {
						?s ?o ?p .
					}					
					"""^^xsd:string ;
		]) .

:UpdateLSRAgentKnowledge
	a bt:Update ;
	rdfs:label "Delete LSR Agent Knowledge" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
				PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
				PREFIX ajan: <http://www.ajan.de/ajan-ns#>
				DELETE {
					?agent welcome:knowsLocalServices ajan:LocalServicesKnowledge .	
				}
				INSERT {
					?agent welcome:needsPopulateLSR "localRepo" .
				}
				WHERE {
					?agent rdf:type ajan:Agent .
				}		"""^^xsd:string ;
		]) .
		
:WriteTriplesLSR
	a bt:Write ;
	rdfs:label "Write Triples in LSR" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:targetBase ajan:LocalServicesKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
			PREFIX owl: <http://www.w3.org/2002/07/owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			CONSTRUCT  {
			  ?s ?o ?p .
			}
			WHERE { 
			  SELECT DISTINCT ?s ?o ?p 
			  WHERE {
				?s ?o ?p .
				?a rdf:type service:Service .
			  }
			} """^^xsd:string ;
	] .

:PluginOWL2PDDL
	a ssc:PDDLConverter ;
	rdfs:label "Plugin: Create PDDL Domain File" ;
	ssc:LocalServicesTriples [
				a bt:SelectQuery ;
				bt:originBase ajan:LocalServicesKnowledge ;
				bt:sparql """
				PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
				SELECT ?s ?o ?p ?g
				WHERE {
					{ GRAPH ?g { ?s ?o ?p } }
				}"""^^xsd:string ;
			] .	

:UpdateAgentKnowsLSR
	a bt:Update ;
	rdfs:label "Update: Agent Knows LSR" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>					
					DELETE {
						welcome:myWelcomeAgent welcome:needsPopulateLSR "localRepo" .
					}
					INSERT {
						?agent welcome:knowsLocalServices ajan:LocalServicesKnowledge .	
					}
					WHERE {
						?agent rdf:type ajan:Agent .
					}					
					"""^^xsd:string ;
		]) .

:WriteTriplesLSRC1
	a bt:Write ;
	rdfs:label "Write Triples in LSR for C1" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:targetBase ajan:LocalServicesKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
			PREFIX owl: <http://www.w3.org/2002/07/owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
                    CONSTRUCT {
                        ?s ?p ?o .
            <http://mycontext1> <http://www.ajan.de/behavior/bt-ns#rdfContext> <file://C:/fakepath/FirstReceptionService.owl> .
                    }

                        WHERE { GRAPH <file://C:/fakepath/FirstReceptionService.owl> {?s ?p ?o .} } """^^xsd:string ;
	] .

:WriteTriplesLSRC2
	a bt:Write ;
	rdfs:label "Write Triples in LSR for C2" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:targetBase ajan:LocalServicesKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
			PREFIX owl: <http://www.w3.org/2002/07/owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
                    CONSTRUCT {
                        ?s ?p ?o .
            <http://mycontext2> <http://www.ajan.de/behavior/bt-ns#rdfContext> <file://C:/fakepath/RegistrationService.owl> .
                    }

                        WHERE { GRAPH <file://C:/fakepath/RegistrationService.owl> {?s ?p ?o .} } """^^xsd:string ;
	] .

:UpdateLSRExecutionKnowledge
	a bt:Update ;
	rdfs:label "Update: LSR in Execution Knowledge" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 	
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
			PREFIX owl: <http://www.w3.org/2002/07/owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			DELETE {
				?s ?p ?o .
			}WHERE {
				?s ?p ?o .
			}"""^^xsd:string ;
		]) .
		
:EventHandlerReceiveLocalAgents
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Receive Local Agents" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#ReceiveLocalAgentsEvent> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:ExecutionKnowledge ;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>	
						CONSTRUCT {
							?s ?p ?o .
							?s rdf:type ajan:Agent .
						}
						WHERE {
							?s ?p ?o .
							?s rdf:type ajan:Agent .
						}"""^^xsd:string ;
				] .
				
:RemoveLARContent
	a bt:Update ;
	rdfs:label "Update: Remove LAR Content" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:LocalAgentsKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					DELETE {
						?s ?o ?p .
					}
					WHERE {
						?s ?o ?p .
					}					
					"""^^xsd:string ;
		]) .

:UpdateLARAgentKnowledge
	a bt:Update ;
	rdfs:label "Delete LAR Agent Knowledge" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
				PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
				PREFIX ajan: <http://www.ajan.de/ajan-ns#>
				DELETE {
					?agent welcome:knowsLocalAgents ?repoName .	
				}
				INSERT {
					?agent welcome:needsPopulateLAR "localRepo" .
				}				
				WHERE {
					?agent rdf:type ajan:Agent .
				}"""^^xsd:string ;
		]) .

:WriteTriplesLAR
	a bt:Write ;
	rdfs:label "Write Triples in LAR" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:targetBase ajan:LocalAgentsKnowledge ;
		bt:sparql """
			PREFIX ajan: <http://www.ajan.de/ajan-ns#>
			CONSTRUCT { 
				?s ?p ?o .
				?s rdf:type ajan:Agent .
			} WHERE  {
				?s ?p ?o .
				?s rdf:type ajan:Agent .
			}"""^^xsd:string ;
	] .
	
:UpdateAgentKnowsLAR
	a bt:Update ;
	rdfs:label "Update: Agent Knows LAR" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>					
					DELETE {
						welcome:myWelcomeAgent welcome:needsPopulateLAR "localRepo" .
					}
					INSERT {
						?agent welcome:knowsLocalAgents ajan:LocalAgentsKnowledge .	
					}
					 WHERE {
						?agent rdf:type ajan:Agent .
					}					
					"""^^xsd:string ;
		]) .
		
:UpdateLARExecutionKnowledge
	a bt:Update ;
	rdfs:label "Update: LAR in Execution Knowledge" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>	
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 					
					DELETE {
						?s ?p ?o .
						?s rdf:type ajan:Agent.
					} WHERE { 						
						?s ?p ?o .
						?s rdf:type ajan:Agent .
						
					}"""^^xsd:string ;
		]) .
		
#=============================================================================================
# HandshakeBT

:EventHandlerHandshake
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Handshake" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#ReceiveHandshakeEvent> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:AgentKnowledge ;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 						
						CONSTRUCT {
							?sub rdf:type welcome:Handshaking .
						}
						WHERE { 
							?sub rdf:type welcome:Handshaking .
							?s ?p ?o .
						} """^^xsd:string ;
				] .

:UpdateCreateHeaderReadinessMessage
	a bt:Update ;
	rdfs:label "Update: Header Readiness Message" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					INSERT {
						welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
						welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
						welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
						welcome:headerUserID welcome:hasHeaderValue ?id .						
					} 
					WHERE { 
						?msg welcome:hasCorrelationID ?correlationID .
						?du rdf:type welcome:DialogueUser .
						?du welcome:hasUserId ?id .
					}
					"""^^xsd:string ;
		]) .
		
:MessageSendAgentReadiness
	a bt:Message ;
	rdfs:label "Message: Send Agent Readiness to App - Handshake"^^xsd:string ;
	rdfs:comment "Message: Send Agent Readiness to App - Handshake"^^xsd:string ;
	bt:targetBase ajan:AgentKnowledge ;  
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
			a bt:SelectQuery;
			a bt:QueryUri ;
			bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?hdrName ?fieldValue
				WHERE {
					{
						?headerName welcome:hasHeaderName ?hdrName .
						?headerName welcome:hasHeaderValue ?fieldValue .
					}
					UNION 
					{
						  VALUES (?hdrName ?fieldValue) {							
							("content-type" "application/ld+json")							
							("Accept" "application/ld+json")
						}
					}
				}"""^^xsd:string
		] ;	
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "application/ld+json"^^xsd:string 
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "application/ld+json"
				]
		) ;			
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:AgentKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>		
						CONSTRUCT {
							?agent welcome:hasMessage "is ready" .
						}
						WHERE {
							?agent rdf:type ajan:Agent .
						}"""^^xsd:string
		  ]
		] ;    
	] ;
	bt:queryUri [
	a bt:SelectQuery ;
	a bt:QueryUri ;
	bt:originBase ajan:AgentKnowledge ;
	bt:sparql """
				SELECT ?requestURI
				WHERE {
				  VALUES ?requestURI { "http://18.224.42.120:9998/welcome/integration/workflow/dispatcher/handshake" }
				}"""^^xsd:string
	] . 
#	bt:queryUri [
#	a bt:SelectQuery ;
#	a bt:QueryUri ;
#	bt:originBase ajan:AgentKnowledge ;
#	bt:sparql """
#				SELECT ?requestURI
#				WHERE {
#				VALUES ?requestURI { "http://localhost:8092/dms/receiveDIP" }
#				}"""^^xsd:string
#	] .
  
:DeleteHeaderReadinessMessageinLAKR
	a bt:Update ;
	rdfs:label "Update: Delete Header Readiness Message in LAKR" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					DELETE {
						welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
						welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
						welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
						welcome:headerUserID welcome:hasHeaderValue ?userID .						
					} 
					WHERE { 
						welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
						welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
						welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
						welcome:headerUserID welcome:hasHeaderValue ?userID .
					}
					"""^^xsd:string ;
		]) .
#=============================================================================================
# ProcessSpeechActsBehavior

:EventSpeaktoavatar
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Speak to Avatar" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#SpeakAvatarEvent> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:ExecutionKnowledge ;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 						
						CONSTRUCT {						    
							welcome:TCN_SpeakToAvatar rdf:type welcome:speakToAvatar .
						}
						WHERE { 
							welcome:TCN_SpeakToAvatar rdf:type welcome:speakToAvatar .
						}"""^^xsd:string ;
				] .

:WriteAgentNameinExecution
	a bt:Write ;
	rdfs:label "Write: Agent Name in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 	
			PREFIX ajan: <http://www.ajan.de/ajan-ns#>
			CONSTRUCT  {
				?agentName rdf:type ajan:Agent .
			}
			WHERE { 
				?agentName rdf:type ajan:Agent .
			} """^^xsd:string ;
	] .
	
:UpdateCreateOpeningDIPPart1
	a bt:Update ;
	rdfs:label "Update: Create Opening DIP 1" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 					
					INSERT {
						welcome:Opening rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .	
						welcome:Opening welcome:hasDIPStatus welcome:Unknown .
						welcome:Opening welcome:isCurrentDIP "true"^^xsd:boolean . 
						welcome:Opening welcome:hasSlot welcome:confirmCommunication .
						welcome:confirmCommunication rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemDemand"^^xsd:anyURI .
						welcome:confirmCommunication welcome:hasOntologyType xsd:boolean .
						welcome:confirmCommunication welcome:hasTemplateId "TConfirmCommunication"^^xsd:string .
						welcome:confirmCommunication welcome:hasInputRDFContents welcome:Unknown .
						welcome:confirmCommunication welcome:hasTCNAnswer welcome:Unknown .
						welcome:confirmCommunication welcome:hasStatus welcome:Pending .
						welcome:confirmCommunication welcome:hasNumberAttempts 0 .
						welcome:confirmCommunication welcome:confidenceScore "0.0"^^xsd:float .
						welcome:confirmCommunication welcome:isOptional "false"^^xsd:boolean .
					} 
					WHERE { 
						?agentName rdf:type ajan:Agent .
					}
					"""^^xsd:string ;
		]) .

:UpdateCreateOpeningDIPPart2
	a bt:Update ;
	rdfs:label "Update: Create Opening DIP Part 2" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					INSERT {
						welcome:Opening welcome:hasSlot welcome:confirmLanguage .
						welcome:confirmLanguage rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemDemand"^^xsd:anyURI .
						welcome:confirmLanguage	welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Language"^^xsd:anyURI .
						welcome:confirmLanguage welcome:hasTemplateId "TConfirmLanguage"^^xsd:string .
						welcome:confirmLanguage	welcome:hasInputRDFContents welcome:Unknown .
						welcome:confirmLanguage welcome:hasTCNAnswer welcome:Unknown .
						welcome:confirmLanguage	welcome:hasStatus welcome:Pending .
						welcome:confirmLanguage	welcome:hasNumberAttempts 0 .
						welcome:confirmLanguage	welcome:confidenceScore "0.0"^^xsd:float .
						welcome:confirmLanguage	welcome:isOptional "false"^^xsd:boolean .			
					} 
					WHERE { 
						?agentName rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .

:UpdateCreateOpeningDIPPart3
	a bt:Update ;
	rdfs:label "Update: Create Opening DIP Part 3" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					INSERT {
						welcome:Opening welcome:hasSlot welcome:obtainRequest .
						welcome:obtainRequest rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemDemand"^^xsd:anyURI .
						welcome:obtainRequest welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#ServiceRequest"^^xsd:anyURI .
						welcome:obtainRequest welcome:hasTemplateId "TObtainMatterConcern"^^xsd:string .
						welcome:obtainRequest welcome:hasStatus welcome:Pending .
						welcome:obtainRequest welcome:hasNumberAttempts 0 .
						welcome:obtainRequest welcome:confidenceScore "0.0"^^xsd:float .	
						welcome:obtainRequest welcome:hasInputRDFContents welcome:Unknown .
						welcome:obtainRequest welcome:hasTCNAnswer welcome:Unknown .
						welcome:obtainRequest welcome:isOptional "false"^^xsd:boolean .					
					} 
					WHERE { 
						?agentName rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .
		
:SendDIPtoKMS
	a bt:Message ;
	rdfs:label "Message: Send DIP to KMS"^^xsd:string ;
	rdfs:comment "Message: Send DIP to KMS"^^xsd:string ;
	bt:targetBase ajan:ExecutionKnowledge ;  
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "text/turtle"^^xsd:string 
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "text/plain"
				]
		) ;	
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX welcomeService: <http://localhost:8080/services/FirstReceptionService.owl#>
						CONSTRUCT {
							?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .	
							?dip welcome:hasDIPStatus ?status .
							?dip welcome:isCurrentDIP ?isCurrentValue .
							?dip welcome:belongsTo ?someService . 
							?dip welcome:hasSlot ?slotDIP .
							?slotDIP rdf:type ?slotType .
							?slotDIP welcome:hasOntologyType ?slotOntoType .
							?slotDIP welcome:hasInputRDFContents ?slotRDFContents .
							?slotRDFContents ?reifiRDFContentsPred ?reifiRDFContentsObj .
							?slotDIP welcome:hasStatus ?slotStatus .
							?slotDIP welcome:hasNumberAttempts ?NbAttempts .
							?slotDIP welcome:confidenceScore ?confScore .
							?slotDIP welcome:isOptional ?opt .
							?slotDIP welcome:hasTemplateId ?templateID .
							?slotDIP welcome:hasTCNAnswer welcome:Unknown .
						}
						WHERE {
							?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .	
							?dip welcome:hasDIPStatus ?status .
							?dip welcome:isCurrentDIP ?isCurrentValue .
							OPTIONAL { ?dip welcome:belongsTo ?someService . }
							?dip welcome:hasSlot ?slotDIP .
							?slotDIP rdf:type ?slotType .
							?slotDIP welcome:hasOntologyType ?slotOntoType .
							?slotDIP welcome:hasInputRDFContents ?slotRDFContents .
							OPTIONAL { ?slotRDFContents ?reifiRDFContentsPred ?reifiRDFContentsObj .}
							?slotDIP welcome:hasStatus ?slotStatus .
							?slotDIP welcome:hasNumberAttempts ?NbAttempts .
							?slotDIP welcome:confidenceScore ?confScore .
							?slotDIP welcome:isOptional ?opt .
							OPTIONAL { ?slotDIP welcome:hasTemplateId ?templateID . }
							OPTIONAL {?slotDIP welcome:hasTCNAnswer ?tcnAnswer .}
						}"""^^xsd:string
			]
		] ;    
	] ;
	bt:queryUri [
		a bt:SelectQuery ;
		a bt:QueryUri ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					SELECT ?requestURI
					WHERE {
					  welcome:KMS welcome:hasURI ?requestURI .
					}"""^^xsd:string
	] .

:UpdateExecutionDeleteDIP
	a bt:Update ;
	rdfs:label "Update: Delete DIP from Execution" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX welcomeService: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>								
					DELETE {
						?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						?dip welcome:hasDIPStatus ?status .
						?dip welcome:isCurrentDIP "true"^^xsd:boolean .
						?dip welcome:hasSlot ?slots .
						?slots rdf:type ?slotType .
						?slots welcome:hasOntologyType ?ontoType .
						?slots welcome:hasInputRDFContents ?RDFContents .
						?slots welcome:hasTCNAnswer ?tcnAnswer .						
						?slots welcome:hasStatus ?slotsStatus .		
						?slots welcome:hasNumberAttempts ?NbAttempts .
						?slots welcome:confidenceScore ?confScore .
						?slots welcome:isOptional ?optional .	
						?slots welcome:hasTemplateId ?templateID .
						?RDFContents ?ReifiPredi ?ReifiObj .					
					} WHERE { 
						?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						?dip welcome:hasDIPStatus ?status .
						?dip welcome:isCurrentDIP "true"^^xsd:boolean .
						?dip welcome:hasSlot ?slots .
						?slots rdf:type ?slotType .
						?slots welcome:hasOntologyType ?ontoType .
						?slots welcome:hasInputRDFContents ?RDFContents .	
						?slots welcome:hasStatus ?slotsStatus .		
						?slots welcome:hasNumberAttempts ?NbAttempts .
						?slots welcome:confidenceScore ?confScore .
						?slots welcome:isOptional ?optional .	
						OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}
							UNION
							{?RDFContents ?ReifiPredi ?ReifiObj .}					
						}
					}"""^^xsd:string ;
		]) .

:EventDIP_OR_ServiceRequest
	a bt:HandleEvent ;
	rdfs:label "EventHandler: DIP OR Service Request" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#EventDIPORServiceRequest> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:AgentKnowledge ;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 						
						CONSTRUCT {								
							?dip welcome:hasNamedGraph ?dipGraph .
							welcome:BT welcome:hasActiveDIP ?dipId .					
						}
						WHERE { 
								?dip welcome:hasNamedGraph ?dipGraph .
								?dip welcome:DIPId ?dipId .
						}"""^^xsd:string ;
				] .

:DeletePreviousDIPinExecution
	a bt:Update ;
	rdfs:label "Update: Delete Previous DIP in Execution" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX welcomeService: <http://localhost:8080/services/FirstReceptionService.owl#>
					DELETE {
							?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							?dip welcome:hasSlot ?slot .
							?dip welcome:DIPId ?dipid .
							?dip welcome:isCurrentDIP ?current .							
							?slot rdf:type ?slottype .
							?slot welcome:hasInputRDFContents ?rdfcontents .
							?slot welcome:hasOntologyType ?ontotype .
							?slot welcome:hasStatus ?statusslot . 
							?slot welcome:confidenceScore ?scoreslot .
							?slot welcome:hasNumberAttempts ?attp .
							?slot welcome:isOptional ?opt .
							?slot welcome:hasTemplateId ?slottemplate . 
							?slot welcome:hasTCNAnswer ?tcnAnswer . 
							?dip welcome:hasDIPStatus ?statusdip .
							?tcnAnswer ?preReifi ?objReifi . 
							?rdfcontents ?contentreifi ?contentObjReifi .
							?dipName welcome:hasNamedGraph ?dipGraph . 
							?bt welcome:hasActiveDIP ?dipId .
							?dip welcome:belongsTo ?someService .							
					}
					WHERE {		
							?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							?dip welcome:hasSlot ?slot .
							?dip welcome:DIPId ?dipid .
							?dip welcome:isCurrentDIP ?current .							
							?slot rdf:type ?slottype .
							?slot welcome:hasInputRDFContents ?rdfcontents .
							?slot welcome:hasOntologyType ?ontotype .
							?slot welcome:hasStatus ?statusslot . 
							?slot welcome:confidenceScore ?scoreslot .
							?slot welcome:hasNumberAttempts ?attp .
							?slot welcome:isOptional ?opt .
							OPTIONAL { ?slot welcome:hasTemplateId ?slottemplate . }
							OPTIONAL { ?slot welcome:hasTCNAnswer ?tcnAnswer . }
							OPTIONAL { ?dip welcome:hasDIPStatus ?statusdip .}
							OPTIONAL { ?tcnAnswer ?preReifi ?objReifi . }
							OPTIONAL { ?rdfcontents ?contentreifi ?contentObjReifi .}
							OPTIONAL { ?dipName welcome:hasNamedGraph ?dipGraph . }
							OPTIONAL { ?bt welcome:hasActiveDIP ?dipId . }
							OPTIONAL { ?dip welcome:belongsTo ?someService .}
					}"""^^xsd:string ;
		]) .

:WriteActiveDIPinExecution
	a bt:Write ;
	rdfs:label "Write: Active DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
			PREFIX welcomeService: <http://localhost:8080/services/FirstReceptionService.owl#>			
			CONSTRUCT  {
				?bt welcome:hasActiveDIP ?dipId . 
				?dip welcome:hasNamedGraph ?dipGraph .
				?s ?p ?o .
			}
			WHERE { 
				?bt welcome:hasActiveDIP ?dipId . 
				?dip welcome:hasNamedGraph ?dipGraph .
				{	GRAPH ?dipGraph {?s ?p ?o . }}
			} """^^xsd:string ;
	] .

:ConditionDIPIncomplete
	a bt:Condition ;
	rdfs:label "Condition: DIP Incomplete?" ;
	bt:query ( [
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX fn: <http://www.w3.org/2005/xpath-functions#>
					ASK
					WHERE { 
							{
								?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								?dip welcome:hasSlot ?slot .
								?dip welcome:DIPId ?id .
								?slot welcome:hasStatus ?status .
								?slot welcome:hasNumberAttempts ?NbAtt .
							}
							FILTER (regex(str(?status), "Pending") || regex(str(?status), "FailedAnalysis") || regex(str(?status), "PendingAgreement") || regex(str(?status), "TCNElaborateRequest") || regex(str(?status), "TCNClarifyRequest") || regex(str(?status), "TopicSwitch") || regex(str(?status), "UnclearAnalysis"))
					}"""^^xsd:string ;
		]) .

:UpdateIncompleteDIP
	a bt:Update ;
	rdfs:label "Update: DIP Incomplete" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					DELETE {
						?dip welcome:hasDIPStatus ?statusDIP .	
					} INSERT {
						?dip welcome:hasDIPStatus welcome:Incomplete .
					}
					WHERE {
						?dip welcome:hasNamedGraph ?dipGraph .
						welcome:BT welcome:hasActiveDIP ?dipId .
						GRAPH ?dipGraph {
							?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							OPTIONAL { ?dip welcome:hasDIPStatus ?status . }
							?dip welcome:DIPId ?dipId .
						}					
					}"""^^xsd:string ;
		]) .

:EventProducerSpecificBTDIPIncomplete
	a bt:EventProducer ;
	rdfs:label "EventProducer: Trigger Specific BT - Incomplete DIP" ;
	ajan:event agents:SpecificBTEvent ;
	bt:content [
					a bt:ConstructQuery ;
					bt:originBase ajan:AgentKnowledge;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							welcome:myWelcomeAgent welcome:execute "IncompleteDIP" .							
						}
						WHERE {
							?s rdf:type ajan:Agent .
						}"""^^xsd:string ;
				] .	
				
:ConditionDIPComplete
	a bt:Condition ;
	rdfs:label "Condition: DIP Complete?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX fn: <http://www.w3.org/2005/xpath-functions#>
					ASK
					WHERE { 
						{
						?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						?dip welcome:hasSlot ?slot .
						?dip welcome:DIPId ?id .
						?slot welcome:hasStatus ?status .
						?slot welcome:hasNumberAttempts ?NbAtt .
						}
						FILTER (
								  !regex(str(?status), "Pending") && 
								  !regex(str(?status), "FailedAnalysis") && 
								  !regex(str(?status), "PendingAgreement") && 
								  !regex(str(?status), "TCNElaborateRequest") && 
								  !regex(str(?status), "TCNClarifyRequest") && 
								  !regex(str(?status), "TopicSwitch") && 
								  !regex(str(?status), "UnclearAnalysis")
							)
					}"""^^xsd:string ;
		]) .

:UpdateCompleteDIP
	a bt:Update ;
	rdfs:label "Update: DIP Complete" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					DELETE { 
						?dip welcome:hasDIPStatus ?status . 
					} INSERT {
						?dip welcome:hasDIPStatus welcome:Complete .
					}
					WHERE {		
							?dip welcome:hasNamedGraph ?dipGraph .
							welcome:BT welcome:hasActiveDIP ?dipId .
							GRAPH ?dipGraph {
								?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								OPTIONAL {?dip welcome:hasDIPStatus ?status }.
								?dip welcome:DIPId ?dipId .
							}
					}"""^^xsd:string ;
		]) .

:ConditionDIPIsNotOpening
	a bt:Condition ;
	rdfs:label "Condition: Active DIP is not Opening?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX welcomeService: <http://localhost:8080/services/FirstReceptionService.owl#>
					ASK
					WHERE { 
						?dip welcome:hasNamedGraph ?dipGraph .
						?dip welcome:DIPId ?id .  
						?stg welcome:hasActiveDIP ?id . 
						?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						FILTER (
							!(  STRENDS(str(?dip), "#Opening") ||
							    STRENDS(str(?dip), ":Opening") )
						) 
						
					} """^^xsd:string ;
		]) .
		
:EventProducerSpecificBTDIPComplete
	a bt:EventProducer ;
	rdfs:label "EventProducer: Trigger Specific BT - Complete DIP" ;
	ajan:event agents:SpecificBTEvent ;
	bt:content [
					a bt:ConstructQuery ;
					bt:originBase ajan:AgentKnowledge;
					bt:sparql """
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>
						CONSTRUCT {
							welcome:myWelcomeAgent welcome:execute "CompleteDIP" .
						}
						WHERE {
							?s rdf:type ajan:Agent .
						}"""^^xsd:string ;
				] .	

:ConditionalNoServiceRequest
	a bt:Condition ;
	rdfs:label "Condition: No Service Request?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					ASK 
					WHERE { 
							?dip welcome:hasNamedGraph ?dipGraph .
							GRAPH ?dipGraph 
							{
								FILTER NOT EXISTS {
													?container rdf:type welcome:SpeechActContainer .
													?container welcome:hasSpeechActType welcome:Commit .
												  }
							}							
					}"""^^xsd:string ;
		]) .

:CreateClosingUponFailureNoRequest
	a bt:Update ;
	rdfs:label "Update: Create Closing Upon Failure DIP - No Service Request or No SSC output" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 										
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					INSERT {
						welcome:ClosingUponFailure rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcome:ClosingUponFailure welcome:hasDIPStatus welcome:Unknown .
						welcome:ClosingUponFailure welcome:isCurrentDIP "true"^^xsd:boolean .
						welcome:ClosingUponFailure welcome:hasSlot welcome:informMessage .
						welcome:informMessage rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
						welcome:informMessage welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .
						welcome:informMessage welcome:hasTemplateId "TInformMessage"^^xsd:string . 
						welcome:informMessage welcome:hasInputRDFContents welcome:reifiedReason2  .
						welcome:informMessage welcome:hasStatus welcome:Pending .
						welcome:informMessage welcome:hasNumberAttempts 0 .
						welcome:informMessage welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informMessage welcome:isOptional "false"^^xsd:boolean .				
						welcome:reifiedReason2 rdf:type rdf:Statement .
						welcome:reifiedReason2 rdf:subject welcome:subTemplate .
						welcome:reifiedReason2 rdf:predicate welcome:isReason .
						welcome:reifiedReason2 rdf:object "STReasonNoFoundService"^^xsd:string .
					} WHERE { 
						?s rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .

:ConditionServiceRequest
	a bt:Condition ;
	rdfs:label "Condition: Commit exists?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					ASK 
					WHERE { 
							?dip welcome:hasNamedGraph ?dipGraph .
							GRAPH ?dipGraph 
							{
								?container rdf:type welcome:SpeechActContainer .
								?container welcome:hasSpeechActType welcome:Commit .
							}							
					}"""^^xsd:string ;
		]) .

:DeletePreviousServiceRequestinExecution
	a bt:Update ;
	rdfs:label "Update: Delete Previous Service Request from Execution" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX welcomeService: <http://localhost:8080/services/FirstReceptionService.owl#>					
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					DELETE {
						?container rdf:type welcome:SpeechActContainer .
						?container welcome:hasSpeechActObject ?containerObject .
						?container welcome:hasSpeechActType welcome:Commit .
						?containerObject rdf:type ?type .
						?containerObject ?property ?PropertyVal .
						?PropertyVal ?pr ?ob . 
					} WHERE { 
							?container rdf:type welcome:SpeechActContainer .
							?container welcome:hasSpeechActObject ?containerObject .
							?container welcome:hasSpeechActType welcome:Commit .
							?containerObject rdf:type ?type .
							?containerObject ?property ?PropertyVal .
							OPTIONAL{ ?PropertyVal ?pr ?ob . }
					}"""^^xsd:string ;
		]) .
		
:WriteServiceRequestinExecution
	a bt:Write ;
	rdfs:label "Write: Service Request in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#> 
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
			CONSTRUCT  {
				?container rdf:type welcome:SpeechActContainer .
				?container welcome:hasSpeechActType welcome:Commit .
				?container welcome:hasSpeechActObject ?o .
				?o rdf:type service:Service . 
				?o service:describedBy ?process .
				?o service:presents ?profile .
				?process ?rel ?objprocess .
				?profile ?relprofile ?objprof .	
			}
			WHERE { 
				?bt welcome:hasActiveDIP ?dipId . 
				?dip welcome:hasNamedGraph ?dipGraph .
				GRAPH ?dipGraph { 
					?container rdf:type welcome:SpeechActContainer .
					?container welcome:hasSpeechActType welcome:Commit .
					?container welcome:hasSpeechActObject ?o .
					?o rdf:type service:Service . 
					?o service:describedBy ?process .
					?o service:presents ?profile .
					?process ?rel ?objprocess .
					?profile ?relprofile ?objprof .	
				}
			}"""^^xsd:string ;
	] .

:InvokeMatchmaker
	a ssc:ServiceComputing ;
	rdfs:label "SSC Plugin: Matchmaker" ;
	ssc:serviceRequest [
				a bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:targetBase ajan:LocalServicesKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
						PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 						
						CONSTRUCT {
							?o rdf:type service:Service . 
							?o service:describedBy ?process .
							?o service:presents ?profile .
							?process ?rel ?objprocess .
							?profile ?relprofile ?objprof .
						}
						WHERE { 
							?s rdf:type welcome:SpeechActContainer .
							?s welcome:hasSpeechActType welcome:Commit .
							?s welcome:hasSpeechActObject ?o .
							?o rdf:type service:Service . 
							?o service:describedBy ?process .
							?o service:presents ?profile .
							?process ?rel ?objprocess .
							?profile ?relprofile ?objprof .							
						} """^^xsd:string ;
			] ;
	ssc:serviceOffer [
				a bt:SelectQuery ;
				bt:originBase ajan:LocalServicesKnowledge ;
				bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					SELECT ?s ?o ?p ?g
					WHERE {
						{ GRAPH ?g { ?s ?o ?p } }
					}"""^^xsd:string ;
			] ;
	ssc:filterModel "text-similarity.filter"^^xsd:string .

:ConditionMatchmakerOutput
	a bt:Condition ;
	rdfs:label "Condition: MatchmakerOutput?" ;
	bt:query ( [
		a bt:AskQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:sparql """
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					ASK
					WHERE {
						?ssc ssc:hasResultOffer ?MatchmakerOffer .	
					}"""^^xsd:string ;
		]) .
		
:PDDL2SPARQLPlugin
	a ssc:PDDL2SPARQL ;
	rdfs:label "PDDL2SPARQL Plugin: Map Precondition" ;
	ssc:servicePrecondition [
				a bt:ConstructQuery ;
				bt:originBase ajan:LocalServicesKnowledge ;
				bt:targetBase ajan:AgentKnowledge ;
				bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>	
					PREFIX pddlexpr: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/PDDLExpression.owl#>	
					PREFIX expr: <http://www.daml.org/services/owl-s/1.1/generic/Expression.owl#>
					CONSTRUCT {
						?MatchmakerOffer welcome:hasPrecondition ?precondition .
					}
					WHERE { 
						?ssc ssc:hasResultOffer ?MatchmakerOffer .
						GRAPH ?g {
							?MatchmakerOffer service:describedBy ?process .
							?process process:hasPrecondition ?precondClass .
							?precondClass expr:expressionBody ?precondition .
						}
					}"""^^xsd:string ;
			] .



:TestBigQuery
	a bt:Write ;
	rdfs:label "Testing Big Query" ;
	bt:query [
				a bt:ConstructQuery ;
				bt:originBase ajan:AgentKnowledge ;
				bt:targetBase ajan:AgentKnowledge ;
				bt:sparql """
	PREFIX ajan: <http://www.ajan.de/ajan-ns#>
	PREFIX welcome: <http://localhost:8090/rdf4j/repositories/welcome_ontology#> 
	PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

	CONSTRUCT{
		_:bNodeSimilarity ajan:subject ?a1;
		ajan:object ?a2;
		welcome:isComputedForProblemId  ?usecaseId;
		welcome:hasPerfectMatchScore ?perfectMatchScore;
		welcome:hasNumberOfAgents ?numberOfAgents;
		ajan:hasSimilarityScore ?totalSml.

		}
	WHERE {
		welcome:UseCase welcome:toBeSolved ?usecase.
		?usecase 	welcome:hasMacProblemId  ?usecaseId;
				welcome:hasNumberOfAgents ?numberOfAgents;
				welcome:hasAgeWeight ?ageWeight;
				welcome:hasGenderWeight ?genWeight;
				welcome:hasFamilyWeight	?famWeight;
				welcome:hasNationalityWeight	?natWeight;
				welcome:hasReligionWeight	?relWeight;
				welcome:hasEthnicityWeight	?ethWeight;
				welcome:hasLocationWeight	?locWeight;
				welcome:hasAccessibilityWeight	?accWeight;
				welcome:hasRentPeriodWeight	?rentWeight;
				welcome:hasShareWithWeight	?shareWeight.


		?a1 a ajan:Agent.
		?a1 welcome:isParticipatingIn ?usecaseId.
	
		?a2 a ajan:Agent.
		?a2 welcome:isParticipatingIn ?usecaseId.

		?a1 welcome:hasAgePreference ?agePrefA1.
		OPTIONAL {
			?agePrefA1 welcome:lowerBound ?lowerAgeA1;
		        welcome:higherBound ?higherAgeA1.
			}.
		?a1 welcome:hasGenderPreference ?genPrefA1.
		?a1 welcome:hasFamilyPreference ?famPrefA1.
		?a1 welcome:hasNationPreference ?natPrefA1.
		?a1 welcome:hasNationality ?nationA1.
		?a1 welcome:hasReligionPreference ?relPrefA1.
		?a1 welcome:hasReligion ?relA1.
		?a1 welcome:hasEthnicPreference ?ethPrefA1.
		?a1 welcome:hasEthnicity ?ethA1.
		?a1 welcome:hasLocationPreference ?locPrefA1.
		?a1 welcome:hasAccessibilityPreference ?accPrefA1.
		?a1 welcome:hasRentPeriodPreference ?rentPrefA1.
		OPTIONAL {
			?rentPrefA1 welcome:startDate ?startRentA1;
		        welcome:endDate ?endRentA1.
			}.
		?a1 welcome:hasShareWithPreference ?sharePrefA1.
		OPTIONAL {
			?sharePrefA1 welcome:min ?minShareA1;
		        welcome:max ?maxShareA1.
			}.

		?a2 welcome:hasAge ?ageA2.
		?a2 welcome:hasGender ?genA2.
		?a2 welcome:hasFamily ?famA2.
		?a2 welcome:hasNationality ?nationA2.
		?a2 welcome:hasReligion ?relA2.
		?a2 welcome:hasEthnicity ?ethA2.
		?a2 welcome:hasLocationPreference ?locPrefA2.
		?a2 welcome:hasAccessibilityPreference ?accPrefA2.
		?a2 welcome:hasRentPeriodPreference ?rentPrefA2.
		OPTIONAL {
			?rentPrefA2 welcome:startDate ?startRentA2;
		        welcome:endDate ?endRentA2.
			}.
		?a2 welcome:hasShareWithPreference ?sharePrefA2.
		OPTIONAL {
			?sharePrefA2 welcome:min ?minShareA2;
		        welcome:max ?maxShareA2.
			}.


		FILTER(?a1 != ?a2)

		BIND(1 AS ?matchScore)
		BIND(0 AS ?unmatchScore)
		BIND(10 AS ?numberOfPreferences)
		BIND((?matchScore * (?ageWeight + ?genWeight + ?famWeight + ?natWeight + ?relWeight + ?ethWeight + ?locWeight + ?accWeight + ?rentWeight + ?shareWeight))/?numberOfPreferences AS ?perfectMatchScore)

	
		BIND(IF(?agePrefA1="Dont mind" || (xsd:integer(?ageA2) >= xsd:integer(?lowerAgeA1) && xsd:integer(?ageA2) <= xsd:integer(?higherAgeA1)), ?matchScore, ?unmatchScore) AS ?ageSml).

		BIND(IF(?genPrefA1="Dont mind" || ?genA2=?genPrefA1, ?matchScore, ?unmatchScore) AS ?genSml).

		BIND(IF(?famPrefA1="Dont mind" || ?famA2=?famPrefA1, ?matchScore, ?unmatchScore) AS ?famSml).

		BIND(IF(?natPrefA1="Dont mind" || (?natPrefA1="Same" && ?nationA1=?nationA2) || (?natPrefA1="Mixed" && ?nationA1!=?nationA2), ?matchScore, ?unmatchScore) AS ?natSml)

		BIND(IF(?relPrefA1="Dont mind" || (?relPrefA1="Same" && ?relA1=?relA2) || (?relPrefA1="Mixed" && ?relA1!=?relA2), ?matchScore, ?unmatchScore) AS ?relSml)

		BIND(IF(?ethPrefA1="Dont mind" || (?ethPrefA1="Same" && ?ethA1=?ethA2) || (?ethPrefA1="Mixed" && ?ethA1!=?ethA2), ?matchScore, ?unmatchScore) AS ?ethSml)
		
		BIND(IF(?locPrefA1="Dont mind" || ?locPrefA2="Dont mind" || ?locPrefA1=?locPrefA2, ?matchScore, ?unmatchScore) AS ?locSml)

		BIND(IF(?accPrefA1="Dont mind" || ?accPrefA2="Dont mind" || ?accPrefA1=?accPrefA2, ?matchScore, ?unmatchScore) AS ?accSml)


		BIND(((year(xsd:dateTime(?endRentA1)) - year(now()))*365 + 30*(month(xsd:dateTime(?endRentA1))) + day(xsd:dateTime(?endRentA1))) AS ?endRentA1IntValue)
		BIND(((year(xsd:dateTime(?endRentA2)) - year(now()))*365 + 30*(month(xsd:dateTime(?endRentA2))) + day(xsd:dateTime(?endRentA2))) AS ?endRentA2IntValue)
		BIND(((year(xsd:dateTime(?startRentA1)) - year(now()))*365 + 30*(month(xsd:dateTime(?startRentA1))) + day(xsd:dateTime(?startRentA1))) AS ?startRentA1IntValue)
		BIND(((year(xsd:dateTime(?startRentA2)) - year(now()))*365 + 30*(month(xsd:dateTime(?startRentA2))) + day(xsd:dateTime(?startRentA2))) AS ?startRentA2IntValue)


		BIND(IF(?endRentA1IntValue>?endRentA2IntValue, ?endRentA2IntValue, ?endRentA1IntValue) AS ?smallerEndRent)
		BIND(IF(?startRentA1IntValue>?startRentA2IntValue, ?startRentA1IntValue, ?startRentA2IntValue) AS ?biggerStartRent)
		BIND(IF(?startRentA1IntValue>?startRentA2IntValue, ?startRentA2IntValue, ?startRentA1IntValue) AS ?smallerStartRent)
		BIND(IF(?endRentA1IntValue>?endRentA2IntValue, ?endRentA1IntValue, ?endRentA2IntValue) AS ?biggerEndRent)

		BIND(?smallerEndRent - ?biggerStartRent + 1 AS ?rentOverlap)
		BIND(?biggerEndRent - ?smallerStartRent + 1 AS ?rentTotal)

		BIND(IF(?rentPrefA1="Dont mind" || ?rentPrefA2="Dont mind", ?matchScore, IF(?startRentA1 > ?endRentA2 || ?startRentA2 > ?endRentA1, ?unmatchScore, 
		xsd:double(?rentOverlap/?rentTotal))) AS ?rentSml)

		BIND(IF(?maxShareA1>?maxShareA2, ?maxShareA2, ?maxShareA1) AS ?smallerMaxShare)

		BIND(IF(?minShareA1>?minShareA2, ?minShareA1, ?minShareA2) AS ?biggerMinShare)

		BIND(IF(?minShareA1>?minShareA2, ?minShareA2, ?minShareA1) AS ?smallerMinShare)

		BIND(IF(?maxShareA1>?maxShareA2, ?maxShareA1, ?maxShareA2) AS ?biggerMaxShare)

		BIND(?smallerMaxShare - ?biggerMinShare + 1 AS ?shareOverlap)
		
		BIND(?biggerMaxShare - ?smallerMinShare + 1 AS ?shareTotal)

		BIND(IF(?sharePrefA1="Dont mind" || ?sharePrefA2="Dont mind", ?matchScore, IF(?minShareA1 > ?maxShareA2 || ?minShareA2 > ?maxShareA1, ?unmatchScore, 
		xsd:double(?shareOverlap/?shareTotal))) AS ?shareSml)
	

		BIND(xsd:float(((?ageSml * ?ageWeight) + (?genSml * ?genWeight) + (?famSml * ?famWeight) + (?natSml * ?natWeight) + (?relSml * ?relWeight) + 
		(?ethSml * ?ethWeight) + (?locSml * ?locWeight) + (?accSml * ?accWeight) + (?rentSml * ?rentWeight) + (?shareSml * ?shareWeight))/10.0) AS ?totalSml).		


		}

					"""^^xsd:string ;
			] .



:HDBSCAN
	a bt:HDBSCAN ;
	rdfs:label "Run HDBSCAN" ;
	bt:query [
				a bt:ConstructQuery ;
				bt:originBase ajan:AgentKnowledge ;
				bt:targetBase ajan:AgentKnowledge ;
				bt:sparql """
			PREFIX ajan: <http://www.ajan.de/ajan-ns#>
			PREFIX welcome: <http://localhost:8090/rdf4j/repositories/welcome_ontology#> 
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

			CONSTRUCT{
				?usecase 	welcome:hasMacProblemId  ?usecaseID;
						welcome:hasPerfectMatchScore ?perfectMatchScore;
						welcome:hasNumberOfAgents ?numberOfAgents;
						welcome:hasParticipants ?agents.

				_:bNodeSimilarity 	ajan:hasSubject ?a1;
							ajan:hasObject ?a2;
							welcome:isComputedForProblemId  ?usecaseId;
							ajan:hasSimilarityScore ?totalSml.
				}
			WHERE {

				{
				welcome:UseCase welcome:toBeSolved ?usecase.

				?usecase 	welcome:hasNumberOfAgents ?numberOfAgents;
						welcome:hasParticipants ?agents;
						welcome:hasMacProblemId  ?usecaseID;
						welcome:hasAgeWeight ?ageWeight;
						welcome:hasGenderWeight ?genWeight;
						welcome:hasFamilyWeight	?famWeight;
						welcome:hasNationalityWeight	?natWeight;
						welcome:hasReligionWeight	?relWeight;
						welcome:hasEthnicityWeight	?ethWeight;
						welcome:hasLocationWeight	?locWeight;
						welcome:hasAccessibilityWeight	?accWeight;
						welcome:hasRentPeriodWeight	?rentWeight;
						welcome:hasShareWithWeight	?shareWeight.


				BIND(1 AS ?matchScore)
				BIND(0 AS ?unmatchScore)
				BIND(10 AS ?numberOfPreferences)
				BIND((?matchScore * (?ageWeight + ?genWeight + ?famWeight + ?natWeight + ?relWeight + ?ethWeight + ?locWeight + ?accWeight + ?rentWeight + ?shareWeight))/?numberOfPreferences AS ?perfectMatchScore)


				} UNION {
				welcome:UseCase welcome:toBeSolved ?usecase.	
				?usecase 	welcome:hasMacProblemId  ?usecaseId;
						welcome:hasAgeWeight ?ageWeight;
						welcome:hasGenderWeight ?genWeight;
						welcome:hasFamilyWeight	?famWeight;
						welcome:hasNationalityWeight	?natWeight;
						welcome:hasReligionWeight	?relWeight;
						welcome:hasEthnicityWeight	?ethWeight;
						welcome:hasLocationWeight	?locWeight;
						welcome:hasAccessibilityWeight	?accWeight;
						welcome:hasRentPeriodWeight	?rentWeight;
						welcome:hasShareWithWeight	?shareWeight.

				BIND(1 AS ?matchScore)
				BIND(0 AS ?unmatchScore)
				?a1 a ajan:Agent.
				?a1 welcome:isParticipatingIn ?usecaseId.
	
				?a2 a ajan:Agent.
				?a2 welcome:isParticipatingIn ?usecaseId.

				?a1 welcome:hasAgePreference ?agePrefA1.
				OPTIONAL {
					?agePrefA1 welcome:lowerBound ?lowerAgeA1;
					        welcome:higherBound ?higherAgeA1.
					}.
				?a1 welcome:hasGenderPreference ?genPrefA1.
				?a1 welcome:hasFamilyPreference ?famPrefA1.
				?a1 welcome:hasNationPreference ?natPrefA1.
				?a1 welcome:hasNationality ?nationA1.
				?a1 welcome:hasReligionPreference ?relPrefA1.
				?a1 welcome:hasReligion ?relA1.
				?a1 welcome:hasEthnicPreference ?ethPrefA1.
				?a1 welcome:hasEthnicity ?ethA1.
				?a1 welcome:hasLocationPreference ?locPrefA1.
				?a1 welcome:hasAccessibilityPreference ?accPrefA1.
				?a1 welcome:hasRentPeriodPreference ?rentPrefA1.
				OPTIONAL {
					?rentPrefA1 welcome:startDate ?startRentA1;
				        welcome:endDate ?endRentA1.
					}.
				?a1 welcome:hasShareWithPreference ?sharePrefA1.
					OPTIONAL {
					?sharePrefA1 welcome:min ?minShareA1;
		        		welcome:max ?maxShareA1.
					}.

				?a2 welcome:hasAge ?ageA2.
				?a2 welcome:hasGender ?genA2.
				?a2 welcome:hasFamily ?famA2.
				?a2 welcome:hasNationality ?nationA2.
				?a2 welcome:hasReligion ?relA2.
				?a2 welcome:hasEthnicity ?ethA2.
				?a2 welcome:hasLocationPreference ?locPrefA2.
				?a2 welcome:hasAccessibilityPreference ?accPrefA2.
				?a2 welcome:hasRentPeriodPreference ?rentPrefA2.
				OPTIONAL {
					?rentPrefA2 welcome:startDate ?startRentA2;
				        welcome:endDate ?endRentA2.
					}.
				?a2 welcome:hasShareWithPreference ?sharePrefA2.
				OPTIONAL {
					?sharePrefA2 welcome:min ?minShareA2;
				        welcome:max ?maxShareA2.
					}.

				FILTER(?a1 != ?a2)


				BIND(IF(?agePrefA1="Dont mind" || (xsd:integer(?ageA2) >= xsd:integer(?lowerAgeA1) && xsd:integer(?ageA2) <= xsd:integer(?higherAgeA1)), ?matchScore, ?unmatchScore) AS ?ageSml).

				BIND(IF(?genPrefA1="Dont mind" || ?genA2=?genPrefA1, ?matchScore, ?unmatchScore) AS ?genSml).

				BIND(IF(?famPrefA1="Dont mind" || ?famA2=?famPrefA1, ?matchScore, ?unmatchScore) AS ?famSml).

				BIND(IF(?natPrefA1="Dont mind" || (?natPrefA1="Same" && ?nationA1=?nationA2) || (?natPrefA1="Mixed" && ?nationA1!=?nationA2), ?matchScore, ?unmatchScore) AS ?natSml)

				BIND(IF(?relPrefA1="Dont mind" || (?relPrefA1="Same" && ?relA1=?relA2) || (?relPrefA1="Mixed" && ?relA1!=?relA2), ?matchScore, ?unmatchScore) AS ?relSml)

				BIND(IF(?ethPrefA1="Dont mind" || (?ethPrefA1="Same" && ?ethA1=?ethA2) || (?ethPrefA1="Mixed" && ?ethA1!=?ethA2), ?matchScore, ?unmatchScore) AS ?ethSml)
		
				BIND(IF(?locPrefA1="Dont mind" || ?locPrefA2="Dont mind" || ?locPrefA1=?locPrefA2, ?matchScore, ?unmatchScore) AS ?locSml)

				BIND(IF(?accPrefA1="Dont mind" || ?accPrefA2="Dont mind" || ?accPrefA1=?accPrefA2, ?matchScore, ?unmatchScore) AS ?accSml)

				BIND(((year(xsd:dateTime(?endRentA1)) - year(now()))*365 + 30*(month(xsd:dateTime(?endRentA1))) + day(xsd:dateTime(?endRentA1))) AS ?endRentA1IntValue)
				BIND(((year(xsd:dateTime(?endRentA2)) - year(now()))*365 + 30*(month(xsd:dateTime(?endRentA2))) + day(xsd:dateTime(?endRentA2))) AS ?endRentA2IntValue)
				BIND(((year(xsd:dateTime(?startRentA1)) - year(now()))*365 + 30*(month(xsd:dateTime(?startRentA1))) + day(xsd:dateTime(?startRentA1))) AS ?startRentA1IntValue)
				BIND(((year(xsd:dateTime(?startRentA2)) - year(now()))*365 + 30*(month(xsd:dateTime(?startRentA2))) + day(xsd:dateTime(?startRentA2))) AS ?startRentA2IntValue)

				BIND(IF(?endRentA1IntValue>?endRentA2IntValue, ?endRentA2IntValue, ?endRentA1IntValue) AS ?smallerEndRent)
				BIND(IF(?startRentA1IntValue>?startRentA2IntValue, ?startRentA1IntValue, ?startRentA2IntValue) AS ?biggerStartRent)
				BIND(IF(?startRentA1IntValue>?startRentA2IntValue, ?startRentA2IntValue, ?startRentA1IntValue) AS ?smallerStartRent)
				BIND(IF(?endRentA1IntValue>?endRentA2IntValue, ?endRentA1IntValue, ?endRentA2IntValue) AS ?biggerEndRent)

				BIND(?smallerEndRent - ?biggerStartRent + 1 AS ?rentOverlap)
				BIND(?biggerEndRent - ?smallerStartRent + 1 AS ?rentTotal)

				BIND(IF(?rentPrefA1="Dont mind" || ?rentPrefA2="Dont mind", ?matchScore, IF(?startRentA1 > ?endRentA2 || ?startRentA2 > ?endRentA1, ?unmatchScore, 
				xsd:double(?rentOverlap/?rentTotal))) AS ?rentSml)

				BIND(IF(?maxShareA1>?maxShareA2, ?maxShareA2, ?maxShareA1) AS ?smallerMaxShare)

				BIND(IF(?minShareA1>?minShareA2, ?minShareA1, ?minShareA2) AS ?biggerMinShare)

				BIND(IF(?minShareA1>?minShareA2, ?minShareA2, ?minShareA1) AS ?smallerMinShare)

				BIND(IF(?maxShareA1>?maxShareA2, ?maxShareA1, ?maxShareA2) AS ?biggerMaxShare)

				BIND(?smallerMaxShare - ?biggerMinShare + 1 AS ?shareOverlap)
		
				BIND(?biggerMaxShare - ?smallerMinShare + 1 AS ?shareTotal)

				BIND(IF(?sharePrefA1="Dont mind" || ?sharePrefA2="Dont mind", ?matchScore, IF(?minShareA1 > ?maxShareA2 || ?minShareA2 > ?maxShareA1, ?unmatchScore, 
				xsd:double(?shareOverlap/?shareTotal))) AS ?shareSml)
	
				BIND(xsd:float(((?ageSml * ?ageWeight) + (?genSml * ?genWeight) + (?famSml * ?famWeight) + (?natSml * ?natWeight) + (?relSml * ?relWeight) + 
				(?ethSml * ?ethWeight) + (?locSml * ?locWeight) + (?accSml * ?accWeight) + (?rentSml * ?rentWeight) + (?shareSml * ?shareWeight))/10.0) AS ?totalSml).		

				}}
					"""^^xsd:string ;
			] .


:CoalitionGenerator
	a bt:CoalitionGenerator ;
	rdfs:label "Generating Coalitions" ;
	bt:query [
				a bt:ConstructQuery ;
				bt:originBase ajan:AgentKnowledge ;
				bt:targetBase ajan:AgentKnowledge ;
				bt:sparql """
					PREFIX welcome: <http://localhost:8090/rdf4j/repositories/welcome_ontology#> 

					Construct {

						welcome:LCC1 ?p ?o.
						?o2 ?p3 ?o3.

					}
					Where{
						{ welcome:LCC1 ?p ?o. }   UNION 
						{ welcome:LCC1 ?p2 ?o2.
						  ?o2 ?p3 ?o3.}
					}
					"""^^xsd:string ;
			] .

:CSGPSolver
	a bt:CSGPSolver ;
	rdfs:label "Solve CSGP" ;
	bt:query [
				a bt:ConstructQuery ;
				bt:originBase ajan:AgentKnowledge ;
				bt:targetBase ajan:AgentKnowledge ;
				bt:sparql """
					PREFIX welcome: <http://localhost:8090/rdf4j/repositories/welcome_ontology#> 

					Construct {

						welcome:LCC1 ?p ?o.
						?o2 ?p3 ?o3.

					}
					Where{
						{ welcome:LCC1 ?p ?o. }   UNION 
						{ welcome:LCC1 ?p2 ?o2.
						  ?o2 ?p3 ?o3.}
					}
					"""^^xsd:string ;
			] .

:ConditionPreconditionHolds
	a bt:Condition ;
	rdfs:label "Condition: Precondition holds?" ;
	bt:query ( [
		a bt:AskQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					ASK
					WHERE {
						?query welcome:hasPreconditionResult "true"^^<http://www.w3.org/2001/XMLSchema#boolean> .	
					}"""^^xsd:string ;
		]) .

:ConditionAtomicService	
	a bt:Condition ;
	rdfs:label "Condition: Atomic Service?" ;
	bt:query ( [
		a bt:AskQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:sparql """
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					ASK
					WHERE {
						?ssc ssc:hasResultOffer ?MatchmakerOffer .
						?MatchmakerOffer rdf:type service:Service .
						?MatchmakerOffer service:describedBy ?process .
						?process rdf:type process:AtomicProcess .
					}"""^^xsd:string ;
		]) .

:CreateAtomicServiceDIP
	a bt:Write ;
	rdfs:label "Write: Create DIP from Atomic" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:AgentKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			CONSTRUCT  {
						?process rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						?process welcome:belongsTo ?matchmakerOffer .
						?process welcome:isCurrentDIP "true"^^xsd:boolean .
						?process welcome:hasDIPStatus welcome:Unknown .
						?process welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					?ssc ssc:hasResultOffer ?matchmakerOffer .
					?matchmakerOffer rdf:type service:Service .
					?service service:describedBy ?process . 
					?process process:hasInput ?input .
					?input process:parameterType ?paramTypeInput .
					?input welcome:hasSlotType ?slotType .
					?input welcome:isOptional ?optionalInput .					
					OPTIONAL { 
						?input welcome:hasTemplateId ?templateIdInput .
					}			  
			} """^^xsd:string ;
	] .
	
:ConditionComposedService
	a bt:Condition ;
	rdfs:label "Condition: Composed Service?" ;
	bt:query ( [
		a bt:AskQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:sparql """
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					ASK
					WHERE {
						?ssc ssc:hasResultOffer ?MatchmakerOffer .
						?MatchmakerOffer rdf:type service:Service .
						?MatchmakerOffer service:describedBy ?process .
						?process rdf:type process:CompositeProcess .
					}"""^^xsd:string ;
		]) .

:CreateComposedServiceDIP
	a bt:Write ;
	rdfs:label "Write: Create DIP from Composite" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:AgentKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			CONSTRUCT  {
						?atomicProcess rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						?atomicProcess welcome:belongsTo ?matchmakerOffer .
						?atomicProcess welcome:isCurrentDIP "true"^^xsd:boolean .
						?atomicProcess welcome:hasDIPStatus welcome:Unknown .
						?atomicProcess welcome:hasSlot ?inputAtomic .
						?inputAtomic rdf:type ?slotType .
						?inputAtomic welcome:hasOntologyType ?paramTypeInput .
						?inputAtomic welcome:hasTemplateId ?templateInput .
						?inputAtomic welcome:isOptional ?optionalOutput .
						?inputAtomic welcome:hasInputRDFContents welcome:Unknown .
						?inputAtomic welcome:hasTCNAnswer welcome:Unknown .
						?inputAtomic welcome:hasStatus welcome:Pending .
						?inputAtomic welcome:hasNumberAttempts 0 .
						?inputAtomic welcome:confidenceScore "0.0"^^xsd:float .	
			}
			WHERE { 
					?ssc ssc:hasResultOffer ?matchmakerOffer .
					?matchmakerOffer service:describedBy ?Compositeprocess . 
					?Compositeprocess process:hasInput ?inputComposite .
					?perform process:process ?atomicProcess .
					?atomicProcess rdf:type process:AtomicProcess .	
					?atomicProcess process:hasInput ?inputAtomic .
					?inputAtomic rdf:type process:Input .					
					?perform process:hasDataFrom ?inputBinding .
					?inputBinding rdf:type process:InputBinding .
					?inputAtomic process:parameterType ?paramTypeInput .
					?inputAtomic welcome:hasSlotType ?slotType .
					OPTIONAL { 
						?inputAtomic welcome:hasTemplateId ?templateInput .
					}
					?inputAtomic welcome:isOptional ?optionalOutput .					
					?inputBinding process:toParam ?inputAtomic .
					?inputBinding process:valueSource ?valOf .
					?valOf rdf:type process:ValueOf .
					?valOf process:theVar ?inputComposite .						
			}"""^^xsd:string ;
	] .

:WriteSSCResultinAgentKB
	a bt:Write ;
	rdfs:label "Write: SSC Result in Agent KB" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:AgentKnowledge ;
		bt:sparql """
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>	
			PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			CONSTRUCT { 
				?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
				?MatchmakerOffer ssc:hasServiceName ?servName .				
			} WHERE  {
				?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
				?MatchmakerOffer rdf:type service:Service .
				?MatchmakerOffer service:presents ?profile .
				?profile profile:serviceName ?servName .
			}"""^^xsd:string ;
	] .

:EventProducerFirstInteractionMove
	a bt:EventProducer ;
	rdfs:label "EventProducer: Trigger First Interaction Move" ;
	ajan:event agents:FirstInteractionBTEvent ;
	bt:content [
					a bt:ConstructQuery ;
					bt:originBase ajan:AgentKnowledge;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							welcome:myWelcomeAgent welcome:hasFirstMove "ServiceInteraction" .
						}
						WHERE {
							?s rdf:type ajan:Agent . 
						}"""^^xsd:string ;
				] .	

:EventProducerAlternativeFirstInteractionMove
	a bt:EventProducer ;
	rdfs:label "EventProducer: Trigger Alternative First Interaction Move" ;
	ajan:event agents:FirstInteractionBTEvent ;
	bt:content [
					a bt:ConstructQuery ;
					bt:originBase ajan:AgentKnowledge;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							welcome:myWelcomeAgent welcome:hasFirstMove "FirstAlternativeMove" .
						}
						WHERE {
							?s rdf:type ajan:Agent .
						}"""^^xsd:string ;
				] .	

:InvokePlanner
	a ssc:ServiceComputing ;
	rdfs:label "SSC Plugin: Planner" ;
	ssc:domainDefinition [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:sparql """
				PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 						
				CONSTRUCT {
						?s welcome:hasPDDLDomain ?p .
				}
				WHERE { 
						?s welcome:hasPDDLDomain ?p .
				} """^^xsd:string ;
	] ;
	ssc:problemInit [
		a bt:ConstructQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 						
					CONSTRUCT {
						?o welcome:hasInitState ?goal .
					}
					WHERE { 
						?s rdf:type welcome:SpeechActContainer .
						?s welcome:hasSpeechActType welcome:Commit .
						?s welcome:hasSpeechActObject ?o .
						?o welcome:hasInitState ?initialState .
					} """^^xsd:string ;
		] ;	
	ssc:problemGoal [
		a bt:ConstructQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
				PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 						
				CONSTRUCT {
					?o welcome:hasGoalState ?goal .
				}
				WHERE { 
					?s rdf:type welcome:SpeechActContainer .
					?s welcome:hasSpeechActType welcome:Commit .
					?s welcome:hasSpeechActObject ?o .
					?o welcome:hasGoalState?initialState .
				} """^^xsd:string ;
	] .	

:ConditionPlannerOutput
	a bt:Condition ;
	rdfs:label "Condition: PlannerOutput?" ;
	bt:query ( [
		a bt:AskQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:sparql """
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					ASK
					WHERE {
						?ssc ssc:hasComposedService ?compositeService .	
					}"""^^xsd:string ;
		]) .
		
:SendPlanDIPKMS
	a bt:Action ;
    rdfs:label "Action: Send Service Plan to KMS" ;
    bt:inputs ( [
		a bt:Input ;
		a bt:ConstructQuery ;
        bt:originBase ajan:AgentKnowledge ;
        bt:sparql """
				PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				"""^^xsd:string ;
		]) ;
		bt:definition services:SendPreconditionServices .
		
:EventDefaultStatementNoOpinion
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Default Statement Non Opinion" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#EventStatementNonOpinion> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:AgentKnowledge ;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 						
						CONSTRUCT {						    
							?s rdf:type welcome:SpeechActContainer .
							?s welcome:hasSpeechActType welcome:Statement-non-opinion .
						}
						WHERE { 
							?s rdf:type welcome:SpeechActContainer .
							?s welcome:hasSpeechActType welcome:Statement-non-opinion .
						}"""^^xsd:string ;
				] .

:CreateClosingUponFailureInternalError
	a bt:Update ;
	rdfs:label "Update: Create Closing Upon Failure DIP - Internal Error" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 										
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					INSERT {
						welcome:ClosingUponFailure rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcome:ClosingUponFailure welcome:hasDIPStatus welcome:Unknown .
						welcome:ClosingUponFailure welcome:isCurrentDIP "true"^^xsd:boolean .
						welcome:ClosingUponFailure welcome:hasSlot welcome:informMessage .
						welcome:informMessage rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
						welcome:informMessage welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .
						welcome:informMessage welcome:hasTemplateId "TInformMessage"^^xsd:string . 
						welcome:informMessage welcome:hasInputRDFContents welcome:reifiedReason2  .
						welcome:informMessage welcome:hasStatus welcome:Pending .
						welcome:informMessage welcome:hasNumberAttempts 0 .
						welcome:informMessage welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informMessage welcome:isOptional "false"^^xsd:boolean .				
						welcome:reifiedReason2 rdf:type rdf:Statement .
						welcome:reifiedReason2 rdf:subject welcome:subTemplate .
						welcome:reifiedReason2 rdf:predicate welcome:isReason .
						welcome:reifiedReason2 rdf:object "STReasonInternalFailure"^^xsd:string .
					} WHERE { 
						?a rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .
		
#=============================================================================================
# SpecificFirstReceptionBT

:EventHandlerGenericFirstInteractionMove
	a bt:HandleEvent ;
	rdfs:label "EventHandler: First Interaction Move" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#FirstInteractionBTEvent> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:AgentKnowledge ;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 					
						CONSTRUCT {
							welcome:myWelcomeAgent welcome:hasFirstMove ?val .
						}
						WHERE { 
							welcome:myWelcomeAgent welcome:hasFirstMove ?val .	
						}"""^^xsd:string ;
				] .

:DeletePrecondition
	a bt:Update ;
	rdfs:label "Update: Delete Service Precondition Result in LAKR" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					DELETE {
						?MatchmakerOffer welcome:hasPrecondition ?precondition .
						?query welcome:hasPreconditionResult ?preconVal .	
					}
					 WHERE {
						?s ?p ?o .
						OPTIONAL { ?MatchmakerOffer welcome:hasPrecondition ?precondition .}
						OPTIONAL { ?query welcome:hasPreconditionResult ?preconVal .}
					}					
					"""^^xsd:string ;
		]) .

:WriteFirstInteractionFlaginExecution
	a bt:Write ;
	rdfs:label "Write: First Interaction Flag in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 					
			CONSTRUCT {
					welcome:myWelcomeAgent welcome:hasFirstMove ?result .
			}
			WHERE { 
					welcome:myWelcomeAgent welcome:hasFirstMove ?result . 
			}"""^^xsd:string ;
	] .
	
:DeleteFirstInteractionFlaginLAKR
	a bt:Update ;
	rdfs:label "Update: Delete First Interaction Flag in LAKR" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					DELETE {
						welcome:myWelcomeAgent welcome:hasFirstMove ?val .		
					}
					WHERE { 
						welcome:myWelcomeAgent welcome:hasFirstMove ?val .	
					}					
					"""^^xsd:string ;
		]) .
		
:ConditionalServiceFirstInteraction
	a bt:Condition ;
	rdfs:label "Condition: First Move of a Found Service?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					ASK
					WHERE { 
							welcome:myWelcomeAgent welcome:hasFirstMove "ServiceInteraction".							
					}"""^^xsd:string ;
		]) .

:WriteObtainRegistrationStatus2Execution
	a bt:Write ;
	rdfs:label "Write: Obtain Registration Status in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>	
			CONSTRUCT  {
				welcomeServices:ObtainRegistrationStatus rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:ObtainRegistrationStatus welcome:belongsTo ?service .
				welcomeServices:ObtainRegistrationStatus welcome:hasDIPStatus ?status .
				welcomeServices:ObtainRegistrationStatus welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:ObtainRegistrationStatus welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .
				?slots welcome:hasTCNAnswer ?tcnAnswer .
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				?slots welcome:hasTemplateId ?templateID .
			}
			WHERE {
				welcomeServices:ObtainRegistrationStatus rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:ObtainRegistrationStatus welcome:belongsTo ?service .
				welcomeServices:ObtainRegistrationStatus welcome:hasDIPStatus ?status .
				welcomeServices:ObtainRegistrationStatus welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:ObtainRegistrationStatus welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .	
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
				FILTER NOT EXISTS
				{	
					GRAPH ?g {
						welcomeServices:ObtainRegistrationStatus rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcomeServices:ObtainRegistrationStatus welcome:DIPId ?dipId .
						welcomeServices:ObtainRegistrationStatus welcome:belongsTo ?service .
						welcomeServices:ObtainRegistrationStatus welcome:hasDIPStatus ?status .
						welcomeServices:ObtainRegistrationStatus welcome:isCurrentDIP "true"^^xsd:boolean .
						welcomeServices:ObtainRegistrationStatus welcome:hasSlot ?slots .
						welcomeServices:ObtainRegistrationStatus ?relDIP ?propDIP .
						?slots rdf:type ?slotType .
						?slots welcome:hasOntologyType ?ontoType .
						?slots welcome:hasInputRDFContents ?RDFContents .	
						?slots welcome:hasStatus ?slotsStatus .		
						?slots welcome:hasNumberAttempts ?NbAttempts .
						?slots welcome:confidenceScore ?confScore .
						?slots welcome:isOptional ?optional .	
						OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
					}
					FILTER regex(str(?g), "DIP") 
				}
			}"""^^xsd:string ;
	] .

:DeleteObtainRegistrationStatusinLAKR
	a bt:Update ;
	rdfs:label "Update: Delete New Obtain Registration Status in LAKR" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>	
					DELETE  {
						welcomeServices:ObtainRegistrationStatus ?rel ?obj .
						?obj ?relObj ?objObj .
						?objObj ?reifiRel ?reifiObj .
					}
					WHERE {
						welcomeServices:ObtainRegistrationStatus ?rel ?obj .
						?obj ?relObj ?objObj .
						FILTER NOT EXISTS
						{	
							GRAPH ?g {
								welcomeServices:ObtainRegistrationStatus ?rel ?obj .
								?obj ?relObj ?objObj .
								OPTIONAL{
								 ?objObj ?reifiRel ?reifiObj .
								}
							}
							FILTER regex(str(?g), "DIP") 
						}
					}"""^^xsd:string ;
		]) .
		
:DeleteFirstInteractionFlaginExecution
	a bt:Update ;
	rdfs:label "Update: Delete First Interaction Move Flag in Execution" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					DELETE {
							welcome:myWelcomeAgent welcome:hasFirstMove ?result.				
					} WHERE { 
						?s ?p ?o .
					}"""^^xsd:string ;
		]) .
		
:EventHandlerNormalClosingScenario
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Normal Closing Scenario" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#CloseScenarioEvent> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:AgentKnowledge ;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 				
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							welcome:TCN_Profile welcome:updated "true" . 			
						}
						WHERE { 
							welcome:TCN_Profile welcome:updated "true" . 						
						}"""^^xsd:string ;
				] .

:UpdateCreateNormalClosing
	a bt:Update ;
	rdfs:label "Update: Create Normal Closing DIP" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 					
					INSERT {
						welcome:NormalClosing rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcome:NormalClosing welcome:hasDIPStatus welcome:Unknown .
						welcome:NormalClosing welcome:hasSlot welcome:informEnd .
						welcome:NormalClosing welcome:hasSlot welcome:obtainConfirmation .
						welcome:NormalClosing welcome:isCurrentDIP "true"^^xsd:boolean . 
						welcome:informEnd rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
						welcome:informEnd welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI . 
						welcome:informEnd welcome:hasTemplateId "TInformEnd"^^xsd:string .
						welcome:informEnd welcome:hasInputRDFContents welcome:Unknown .
						welcome:informEnd welcome:hasTCNAnswer welcome:Unknown .
						welcome:informEnd welcome:hasStatus welcome:Pending .
						welcome:informEnd welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:informEnd welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informEnd welcome:isOptional "false"^^xsd:boolean .
						welcome:obtainConfirmation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#ConfirmationRequest"^^xsd:anyURI . 
						welcome:obtainConfirmation welcome:hasOntologyType "http://www.w3.org/2001/XMLSchema#boolean"^^xsd:anyURI .
						welcome:obtainConfirmation welcome:hasTemplateId "TObtainConfirmation"^^xsd:string .
						welcome:obtainConfirmation welcome:hasInputRDFContents welcome:Unknown .
						welcome:obtainConfirmation welcome:hasTCNAnswer welcome:Unknown .
						welcome:obtainConfirmation welcome:hasStatus welcome:Pending .
						welcome:obtainConfirmation welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:obtainConfirmation welcome:confidenceScore "0.0"^^xsd:float .
						welcome:obtainConfirmation welcome:isOptional "false"^^xsd:boolean .					
					} 
					WHERE { 
						?s ?p ?o .
					}"""^^xsd:string ;
		]) .
		
:EventHandlerSpecificBT
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Specific BT" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#SpecificBTEvent> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:AgentKnowledge ;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 				
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							welcome:myWelcomeAgent welcome:execute ?val .			
						}
						WHERE { 
							welcome:myWelcomeAgent welcome:execute ?val .						
						}"""^^xsd:string ;
				] .

:DeletePreviousFlaginExecution
	a bt:Update ;
	rdfs:label "Update: Delete Previous Specific BT Flag in Execution" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					DELETE {
						welcome:myWelcomeAgent welcome:execute ?val .		
					} WHERE { 
						OPTIONAL{
							welcome:myWelcomeAgent welcome:execute ?val . 
						}
					}"""^^xsd:string ;
		]) .

:WriteSpecificBTFlaginExecution
	a bt:Write ;
	rdfs:label "Write: Specific BT Flag in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>	
			CONSTRUCT  {
				welcome:myWelcomeAgent welcome:execute ?val .	
			}
			WHERE {
				welcome:myWelcomeAgent welcome:execute ?val .	
			}"""^^xsd:string ;
	] .
	
:DeleteSpecificBTFlag
	a bt:Update ;
	rdfs:label "Update: Delete Specific BT Flag in LAKR" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					DELETE {
						welcome:myWelcomeAgent welcome:execute ?val .		
					} WHERE { 
						welcome:myWelcomeAgent welcome:execute ?val . 
					}"""^^xsd:string ;
		]) .
		
:DeleteActiveDIPinExecution
	a bt:Update ;
	rdfs:label "Delete Previous Active DIP in Execution" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX welcomeService: <http://localhost:8080/services/FirstReceptionService.owl#>
					DELETE {
							?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							?dip welcome:hasSlot ?slot .
							?dip welcome:DIPId ?dipid .
							?dip welcome:isCurrentDIP ?current .							
							?slot rdf:type ?slottype .
							?slot welcome:hasInputRDFContents ?rdfcontents .
							?slot welcome:hasOntologyType ?ontotype .
							?slot welcome:hasStatus ?statusslot . 
							?slot welcome:confidenceScore ?scoreslot .
							?slot welcome:hasNumberAttempts ?attp .
							?slot welcome:isOptional ?opt .
							?slot welcome:hasTemplateId ?slottemplate . 
							?slot welcome:hasTCNAnswer ?tcnAnswer . 
							?dip welcome:hasDIPStatus ?statusdip .
							?tcnAnswer ?preReifi ?objReifi . 
							?rdfcontents ?contentreifi ?contentObjReifi .
							?dipName welcome:hasNamedGraph ?dipGraph . 
							?bt welcome:hasActiveDIP ?activeId . 	
							?dip welcome:belongsTo ?someService .							
					}
					WHERE {		
							?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							?dip welcome:hasSlot ?slot .
							OPTIONAL { ?dip welcome:DIPId ?dipid .}
							?dip welcome:isCurrentDIP ?current .							
							?slot rdf:type ?slottype .
							?slot welcome:hasInputRDFContents ?rdfcontents .
							?slot welcome:hasOntologyType ?ontotype .
							?slot welcome:hasStatus ?statusslot . 
							?slot welcome:confidenceScore ?scoreslot .
							?slot welcome:hasNumberAttempts ?attp .
							?slot welcome:isOptional ?opt .
							OPTIONAL { ?slot welcome:hasTemplateId ?slottemplate . }
							OPTIONAL { ?slot welcome:hasTCNAnswer ?tcnAnswer . }
							OPTIONAL { ?dip welcome:hasDIPStatus ?statusdip .}
							OPTIONAL { ?tcnAnswer ?preReifi ?objReifi . }
							OPTIONAL { ?rdfcontents ?contentreifi ?contentObjReifi .}
							OPTIONAL { ?dipName welcome:hasNamedGraph ?dipGraph . }
							OPTIONAL { ?bt welcome:hasActiveDIP ?activeId . }
							OPTIONAL { ?dip welcome:belongsTo ?someService .}
					}"""^^xsd:string ;
		]) .

:DeleteActiveDIPinAgentKB
	a bt:Update ;
	rdfs:label "Update: Remove Active DIPs in LAKR" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					DELETE {
						?bt welcome:hasActiveDIP ?id .	
						?dip welcome:hasNamedGraph ?dipGraph .
					}
					 WHERE {
						OPTIONAL { ?bt welcome:hasActiveDIP ?id .}	
						OPTIONAL { ?dip welcome:hasNamedGraph ?dipGraph .}					
					}"""^^xsd:string ;
		]) .

:ConditionalFlagIncomplete
	a bt:Condition ;
	rdfs:label "Condition: Specific BT Flag Incomplete?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					ASK
					WHERE { 
							welcome:myWelcomeAgent welcome:execute "IncompleteDIP" .	
					}"""^^xsd:string ;
		]) .

:ConditionalDIPIncompleteOrMultiple
	a bt:Condition ;
	rdfs:label "Condition: DIP Incomplete? or Multiple DIP?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					ASK
					WHERE { 
							{	?bt welcome:hasActiveDIP ?id . 
								?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								?dip welcome:DIPId ?id .
							}
							UNION
							{ 
								{
									SELECT (COUNT(?id) as ?counter)
									WHERE {
										?bt welcome:hasActiveDIP ?id .
									}
								}
								FILTER(?counter > 1) 
							}							
					}"""^^xsd:string ;
		]) .

:UpdateCreateHeaderDMSMessage
	a bt:Update ;
	rdfs:label "Update: Header DMS Message" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					INSERT {
						welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
						welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
						welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
						welcome:headerUserID welcome:hasHeaderValue ?id .	
						welcome:headerAvatarGender welcome:hasHeaderName "X-Avatar-Gender" .
						welcome:headerAvatarGender welcome:hasHeaderValue ?value .
						welcome:headerLanguage welcome:hasHeaderName "X-Language" .
						welcome:headerLanguage welcome:hasHeaderValue ?preferedLang .
					} 
					WHERE { 
						?message welcome:hasCorrelationID ?correlationID .
						?du rdf:type welcome:DialogueUser .
						?du welcome:hasUserId ?id .
						?du welcome:hasLanguage ?lang .
						?lang rdf:type welcome:Language .
						?lang welcome:hasValue ?preferedLang .
						OPTIONAL {
							welcome:Avatar welcome:hasGender welcome:Gender .
							welcome:Gender welcome:hasValue ?value .
						}
					}
					"""^^xsd:string ;
		]) .
		
:SendIncompleteOrMultipleDIPDMS
	a bt:Message ;
	rdfs:label "Message: Send Multiple or Incomplete DIP to DMS"^^xsd:string ;
	rdfs:comment "Message: Send Multiple or Incomplete DIP to DMS"^^xsd:string ;
	bt:targetBase ajan:AgentKnowledge ;  
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
		  a bt:SelectQuery;
		  a bt:QueryUri ;
		  bt:originBase ajan:AgentKnowledge ;
		  bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					SELECT ?hdrName ?fieldValue
					WHERE {
						{
							?headerName welcome:hasHeaderName ?hdrName .
							?headerName welcome:hasHeaderValue ?fieldValue .
						}
						UNION 
						{
							  VALUES (?hdrName ?fieldValue) {							
								("content-type" "application/ld+json")							
								("Accept" "application/ld+json")
							}
						}
					}"""^^xsd:string
		] ;
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "application/ld+json"^^xsd:string 
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "application/ld+json"
				]
		) ;	
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .					
							?dip welcome:DIPId ?id .
							?dip welcome:isCurrentDIP ?current .
							?dip welcome:hasSlot ?slots .
							?slots rdf:type ?slotType .
							?slots welcome:hasTemplateId ?templateID .	
							?slots welcome:hasInputRDFContents ?RDFContents .
							?slots welcome:hasTCNAnswer ?tcnAnswer .
							?slots welcome:hasOntologyType ?ontoType .
							?tcnAnswer ?reifiPredAnswer ?reifiedObjAnswer .
							?RDFContents ?ReifiPredi ?ReifiObj .					
							?slots welcome:hasStatus ?slotsStatus .		
							?slots welcome:hasNumberAttempts ?NbAttempts .
							?slots welcome:confidenceScore ?confScore .
							?slots welcome:isOptional ?optional .
						}
						WHERE {
							?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .					
							?dip welcome:DIPId ?id .
							?dip welcome:isCurrentDIP ?current .
							?dip welcome:hasSlot ?slots .
							?slots rdf:type ?slotType .
							?slots welcome:hasOntologyType ?ontoType .
							?slots welcome:hasInputRDFContents ?RDFContents .	
							?slots welcome:hasStatus ?slotsStatus .		
							?slots welcome:hasNumberAttempts ?NbAttempts .
							?slots welcome:confidenceScore ?confScore .
							?slots welcome:isOptional ?optional .	
							OPTIONAL { ?slots welcome:hasTemplateId ?templateID .	}
							OPTIONAL { ?slots welcome:hasTCNAnswer ?tcnAnswer . }
							OPTIONAL { ?RDFContents ?ReifiPredi ?ReifiObj . }
							OPTIONAL { ?tcnAnswer ?reifiPredAnswer ?reifiedObjAnswer . }
						}"""^^xsd:string
			]
		] ;    
	] ;
	bt:queryUri [
		a bt:SelectQuery ;
		a bt:QueryUri ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					SELECT ?requestURI
					WHERE {
					  VALUES ?requestURI { "http://18.224.42.120:9998/welcome/integration/workflow/dispatcher/toTcn?log=true" }
					}"""^^xsd:string
	] .
#	bt:queryUri [
#		a bt:SelectQuery ;
#		a bt:QueryUri ;
#		bt:originBase ajan:AgentKnowledge ;
#		bt:sparql """
#					SELECT ?requestURI
#					WHERE {
#					  VALUES ?requestURI { "http://localhost:8092/dms/receiveDIP" }
#					}"""^^xsd:string
#	] .

:DeleteHeaderDMSMessage 
	a bt:Update ;
	rdfs:label "Update: Delete Header DMS Message in LAKR" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					DELETE {
						welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
						welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
						welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
						welcome:headerUserID welcome:hasHeaderValue ?userID .	
						welcome:headerAvatarGender welcome:hasHeaderName "X-Avatar-Gender" .
						welcome:headerAvatarGender welcome:hasHeaderValue ?value .
						welcome:headerLanguage welcome:hasHeaderName "X-Language" .
						welcome:headerLanguage welcome:hasHeaderValue ?preferedLang .					
					} 
					WHERE { 
						OPTIONAL{
							welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
							welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
							welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
							welcome:headerUserID welcome:hasHeaderValue ?userID .	
							welcome:headerAvatarGender welcome:hasHeaderName "X-Avatar-Gender" .
							welcome:headerAvatarGender welcome:hasHeaderValue ?value .
							welcome:headerLanguage welcome:hasHeaderName "X-Language" .
							welcome:headerLanguage welcome:hasHeaderValue ?preferedLang .
						}
					}
					"""^^xsd:string ;
		]) .

:ConditionalObtainRegistrationStatusCompleteAndYesAnswer
	a bt:Condition ;
	rdfs:label "Condition: Obtain Registration Status Complete and Yes Answer?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							welcomeServices:ObtainRegistrationStatus rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							welcomeServices:ObtainRegistrationStatus welcome:DIPId ?id .
							welcomeServices:ObtainRegistrationStatus welcome:hasSlot welcomeServices:obtainStatus .	
							welcomeServices:obtainStatus welcome:hasInputRDFContents ?RDFContents .
							welcomeServices:obtainStatus welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?ReifiSub .
							?reifiedAnswer rdf:predicate ?ReifiPredi .
							?reifiedAnswer rdf:object "Yes" .
					}"""^^xsd:string ;
		]) .

:WriteProposeService2Execution	
	a bt:Write ;
	rdfs:label "Write: Propose Service in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>	
			CONSTRUCT  {
				welcomeServices:ProposeService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:ProposeService welcome:belongsTo ?service .
				welcomeServices:ProposeService welcome:hasDIPStatus ?status .
				welcomeServices:ProposeService welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:ProposeService welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .
				?slots welcome:hasTCNAnswer ?tcnAnswer .
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				?slots welcome:hasTemplateId ?templateID .
			}
			WHERE {
				welcomeServices:ProposeService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:ProposeService welcome:belongsTo ?service .
				welcomeServices:ProposeService welcome:hasDIPStatus ?status .
				welcomeServices:ProposeService welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:ProposeService welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .	
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
				FILTER NOT EXISTS
				{	
					GRAPH ?g {
						welcomeServices:ProposeService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcomeServices:ProposeService welcome:DIPId ?dipId .
						welcomeServices:ProposeService welcome:belongsTo ?service .
						welcomeServices:ProposeService welcome:hasDIPStatus ?status .
						welcomeServices:ProposeService welcome:isCurrentDIP "true"^^xsd:boolean .
						welcomeServices:ProposeService welcome:hasSlot ?slots .
						welcomeServices:ProposeService ?relDIP ?propDIP .
						?slots rdf:type ?slotType .
						?slots welcome:hasOntologyType ?ontoType .
						?slots welcome:hasInputRDFContents ?RDFContents .	
						?slots welcome:hasStatus ?slotsStatus .		
						?slots welcome:hasNumberAttempts ?NbAttempts .
						?slots welcome:confidenceScore ?confScore .
						?slots welcome:isOptional ?optional .	
						OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
					}
					FILTER regex(str(?g), "DIP") 
				}
			}"""^^xsd:string ;
	] .

:WriteSSCResultinExecution
	a bt:Write ;
	rdfs:label "Write: SSC Result in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
			CONSTRUCT { 
				?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
				?MatchmakerOffer ssc:hasServiceName ?servName .				
			} WHERE  {
				?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
				?MatchmakerOffer rdf:type service:Service .
				?MatchmakerOffer service:presents ?profile .
				?profile profile:serviceName ?servName .
			}"""^^xsd:string ;		
	] .
	
:UpdateProposeService
	a bt:Update ;
	rdfs:label "Update: Propose Service with SSC Result" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>	
					DELETE {
						welcomeServices:obtainInterest welcome:hasInputRDFContents ?RDFContents .
						?RDFContents ?ReifiPredi ?ReifiObj .
					}
					INSERT {
						welcomeServices:obtainInterest welcome:hasInputRDFContents welcome:reifiedInterest .
						welcome:reifiedInterest rdf:type rdf:Statement .						
						welcome:reifiedInterest rdf:subject welcome:ServiceName .
						welcome:reifiedInterest rdf:predicate welcome:hasValue .
						welcome:reifiedInterest rdf:object ?servName .
					}
					WHERE {		
						welcomeServices:ProposeService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcomeServices:ProposeService ?rel ?val .
						welcomeServices:ProposeService welcome:hasSlot welcomeServices:obtainInterest .
						welcomeServices:obtainInterest welcome:hasInputRDFContents ?RDFContents .
						?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
						?MatchmakerOffer ssc:hasServiceName ?servName .	
						OPTIONAL {
							?RDFContents ?ReifiPredi ?ReifiObj .
						}					
					}"""^^xsd:string ;
		]) .
		
:DeleteSSCResultinAgentKB
	a bt:Update ;
	rdfs:label "Update: Delete SSC Result in Agent KB" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>		
					DELETE {
						?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
						?MatchmakerOffer ssc:hasServiceName ?servName .	
					}
					WHERE {		
						OPTIONAL {
							?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
							?MatchmakerOffer ssc:hasServiceName ?servName .
						}
					}"""^^xsd:string ;
		]) .
		
:DeleteSSCResultinLSR
	a bt:Update ;
	rdfs:label "Update: Delete SSC Result in LSR" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>	
					DELETE {
						?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
					}
					WHERE {		
						?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
					}"""^^xsd:string ;
		]) .
		
:ConditionalObtainRegistrationStatusCompleteAndNotAnswer
	a bt:Condition ;
	rdfs:label "Condition: Obtain Registration Status Complete and Not Answer?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							welcomeServices:ObtainRegistrationStatus rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							welcomeServices:ObtainRegistrationStatus welcome:DIPId ?id .
							welcomeServices:ObtainRegistrationStatus welcome:hasDIPStatus welcome:Complete .
							welcomeServices:ObtainRegistrationStatus welcome:hasSlot welcomeServices:obtainStatus .	
							welcomeServices:obtainStatus welcome:hasInputRDFContents ?RDFContents .
							welcomeServices:obtainStatus welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?ReifiSub .
							?reifiedAnswer rdf:predicate ?ReifiPredi .
							?reifiedAnswer rdf:object "Not"^^xsd:string .
					}"""^^xsd:string ;
		]) .

:WriteObtainRegistrationServiceInfo2Execution
	a bt:Write ;
	rdfs:label "Write: Obtain Registration Service Info in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>	
			CONSTRUCT  {
				welcomeServices:ObtainRegistrationServiceInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:ObtainRegistrationServiceInfo welcome:belongsTo ?service .
				welcomeServices:ObtainRegistrationServiceInfo welcome:hasDIPStatus ?status .
				welcomeServices:ObtainRegistrationServiceInfo welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:ObtainRegistrationServiceInfo welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .
				?slots welcome:hasTCNAnswer ?tcnAnswer .
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				?slots welcome:hasTemplateId ?templateID .
			}
			WHERE {
				welcomeServices:ObtainRegistrationServiceInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:ObtainRegistrationServiceInfo welcome:belongsTo ?service .
				welcomeServices:ObtainRegistrationServiceInfo welcome:hasDIPStatus ?status .
				welcomeServices:ObtainRegistrationServiceInfo welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:ObtainRegistrationServiceInfo welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .	
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
				FILTER NOT EXISTS
				{	
					GRAPH ?g {
						welcomeServices:ObtainRegistrationServiceInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcomeServices:ObtainRegistrationServiceInfo welcome:DIPId ?dipId .
						welcomeServices:ObtainRegistrationServiceInfo welcome:belongsTo ?service .
						welcomeServices:ObtainRegistrationServiceInfo welcome:hasDIPStatus ?status .
						welcomeServices:ObtainRegistrationServiceInfo welcome:isCurrentDIP "true"^^xsd:boolean .
						welcomeServices:ObtainRegistrationServiceInfo welcome:hasSlot ?slots .
						welcomeServices:ObtainRegistrationServiceInfo ?relDIP ?propDIP .
						?slots rdf:type ?slotType .
						?slots welcome:hasOntologyType ?ontoType .
						?slots welcome:hasInputRDFContents ?RDFContents .	
						?slots welcome:hasStatus ?slotsStatus .		
						?slots welcome:hasNumberAttempts ?NbAttempts .
						?slots welcome:confidenceScore ?confScore .
						?slots welcome:isOptional ?optional .	
						OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
					}
					FILTER regex(str(?g), "DIP") 
				}
			}"""^^xsd:string ;
	] .

:ConditionalProposeServiceCompleteAndYes
	a bt:Condition ;
	rdfs:label "Condition: Propose Service DIP Complete? and Yes Answer" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							welcomeServices:ProposeService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							welcomeServices:ProposeService welcome:DIPId ?id .
							welcomeServices:ProposeService welcome:hasSlot welcomeServices:obtainInterest .	
							welcomeServices:obtainInterest welcome:hasInputRDFContents ?RDFContents .
							welcomeServices:obtainInterest welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?ReifiSub .
							?reifiedAnswer rdf:predicate ?ReifiPredi .
							?reifiedAnswer rdf:object "Yes"  .
					}"""^^xsd:string ;
		]) .

:WriteInformFirstReception2Execution
	a bt:Write ;
	rdfs:label "Write: Inform First Reception in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>	
			CONSTRUCT  {
				welcomeServices:InformFirstReceptionService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:InformFirstReceptionService welcome:belongsTo ?service .
				welcomeServices:InformFirstReceptionService welcome:hasDIPStatus ?status .
				welcomeServices:InformFirstReceptionService welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:InformFirstReceptionService welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .
				?slots welcome:hasTCNAnswer ?tcnAnswer .
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				?slots welcome:hasTemplateId ?templateID .
			}
			WHERE {
				welcomeServices:InformFirstReceptionService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:InformFirstReceptionService welcome:belongsTo ?service .
				welcomeServices:InformFirstReceptionService welcome:hasDIPStatus ?status .
				welcomeServices:InformFirstReceptionService welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:InformFirstReceptionService welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .	
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
				FILTER NOT EXISTS
				{	
					GRAPH ?g {
						welcomeServices:InformFirstReceptionService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcomeServices:InformFirstReceptionService welcome:DIPId ?dipId .
						welcomeServices:InformFirstReceptionService welcome:belongsTo ?service .
						welcomeServices:InformFirstReceptionService welcome:hasDIPStatus ?status .
						welcomeServices:InformFirstReceptionService welcome:isCurrentDIP "true"^^xsd:boolean .
						welcomeServices:InformFirstReceptionService welcome:hasSlot ?slots .
						welcomeServices:InformFirstReceptionService ?relDIP ?propDIP .
						?slots rdf:type ?slotType .
						?slots welcome:hasOntologyType ?ontoType .
						?slots welcome:hasInputRDFContents ?RDFContents .	
						?slots welcome:hasStatus ?slotsStatus .		
						?slots welcome:hasNumberAttempts ?NbAttempts .
						?slots welcome:confidenceScore ?confScore .
						?slots welcome:isOptional ?optional .	
						OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
					}
					FILTER regex(str(?g), "DIP") 
				}
			}"""^^xsd:string ;
	] .

:ConditionalProposeServiceCompleteAndNot
	a bt:Condition ;
	rdfs:label "Condition: Propose Service DIP Complete? and Not Answer" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							welcomeServices:ProposeService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							welcomeServices:ProposeService welcome:DIPId ?id .
							welcomeServices:ProposeService welcome:hasSlot welcomeServices:obtainInterest .	
							welcomeServices:obtainInterest welcome:hasInputRDFContents ?RDFContents .
							welcomeServices:obtainInterest welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?ReifiSub .
							?reifiedAnswer rdf:predicate ?ReifiPredi .
							?reifiedAnswer rdf:object "Not"  .
					}"""^^xsd:string ;
		]) .

:UpdateCreateInformContactNGO
	a bt:Update ;
	rdfs:label "Update: Create Inform Contact NGO DIP" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 	
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>
					INSERT {
						welcome:InformContactNGO rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcome:InformContactNGO welcome:hasDIPStatus welcome:Unknown .
						welcome:InformContactNGO welcome:hasSlot welcome:informGenericDTASFContact .
						welcome:InformContactNGO welcome:hasSlot welcome:obtainConfirmation .
						welcome:InformContactNGO welcome:isCurrentDIP "true"^^xsd:boolean . 
						welcome:informGenericDTASFContact rdf:type welcome:SystemInfo .
						welcome:informGenericDTASFContact welcome:hasOntologyType welcome:Template .
						welcome:informGenericDTASFContact welcome:hasTemplateId "TInformGenericContact"^^xsd:string .
						welcome:informGenericDTASFContact welcome:hasInputRDFContents welcome:Unknown .
						welcome:informGenericDTASFContact welcome:hasTCNAnswer welcome:Unknown .
						welcome:informGenericDTASFContact welcome:hasStatus welcome:Pending .
						welcome:informGenericDTASFContact welcome:hasNumberAttempts 0 .
						welcome:informGenericDTASFContact welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informGenericDTASFContact welcome:isOptional "false"^^xsd:boolean .
						welcome:obtainConfirmation rdf:type welcome:ConfirmationRequest .
						welcome:obtainConfirmation welcome:hasOntologyType xsd:boolean .
						welcome:obtainConfirmation welcome:hasTemplateId "TObtainConfirmation"^^xsd:string .
						welcome:obtainConfirmation welcome:hasInputRDFContents welcome:Unknown .
						welcome:obtainConfirmation welcome:hasTCNAnswer welcome:Unknown .
						welcome:obtainConfirmation welcome:hasStatus welcome:Pending .
						welcome:obtainConfirmation welcome:hasNumberAttempts 0 .
						welcome:obtainConfirmation welcome:confidenceScore "0.0"^^xsd:float .
						welcome:obtainConfirmation welcome:isOptional "false"^^xsd:boolean .					
					} WHERE {
						?s rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .

:ConditionalObtainRegistrationServiceInfoComplete
	a bt:Condition ;
	rdfs:label "Condition: Obtain Registration Service Info Complete?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							welcomeServices:ObtainRegistrationServiceInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							welcomeServices:ObtainRegistrationServiceInfo welcome:DIPId ?id .
					}"""^^xsd:string ;
		]) .

:WriteInformRegistrationService2Execution
	a bt:Write ;
	rdfs:label "Write: Inform Registration Service in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>	
			CONSTRUCT  {
				welcomeServices:InformRegistrationService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:InformRegistrationService welcome:belongsTo ?service .
				welcomeServices:InformRegistrationService welcome:hasDIPStatus ?status .
				welcomeServices:InformRegistrationService welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:InformRegistrationService welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .
				?slots welcome:hasTCNAnswer ?tcnAnswer .
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				?slots welcome:hasTemplateId ?templateID .
			}
			WHERE {
				welcomeServices:InformRegistrationService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:InformRegistrationService welcome:belongsTo ?service .
				welcomeServices:InformRegistrationService welcome:hasDIPStatus ?status .
				welcomeServices:InformRegistrationService welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:InformRegistrationService welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .	
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
				FILTER NOT EXISTS
				{	
					GRAPH ?g {
						welcomeServices:InformRegistrationService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcomeServices:InformRegistrationService welcome:DIPId ?dipId .
						welcomeServices:InformRegistrationService welcome:belongsTo ?service .
						welcomeServices:InformRegistrationService welcome:hasDIPStatus ?status .
						welcomeServices:InformRegistrationService welcome:isCurrentDIP "true"^^xsd:boolean .
						welcomeServices:InformRegistrationService welcome:hasSlot ?slots .
						welcomeServices:InformRegistrationService ?relDIP ?propDIP .
						?slots rdf:type ?slotType .
						?slots welcome:hasOntologyType ?ontoType .
						?slots welcome:hasInputRDFContents ?RDFContents .	
						?slots welcome:hasStatus ?slotsStatus .		
						?slots welcome:hasNumberAttempts ?NbAttempts .
						?slots welcome:confidenceScore ?confScore .
						?slots welcome:isOptional ?optional .	
						OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
					}
					FILTER regex(str(?g), "DIP") 
				}
			}"""^^xsd:string ;
	] .

:DeletePreviousRegistrationOfficesinExecution
	a bt:Update ;
	rdfs:label "Update: Delete Previous Address Coordinates in Execution" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					DELETE {
						?tcnIRI welcome:hasClosestRegistrationOffice ?officeIRI . 
						?tcn rdf:type welcome:DialogueUser . 
						?tcn welcome:long ?longvalue . 
						?tcn welcome:lat ?latvalue . 
						?office rdf:type welcome:RegistrationOffice . 
						?office ?proOffice ?valOffice . 
					}
					WHERE {	
						OPTIONAL { ?tcnIRI welcome:hasClosestRegistrationOffice ?officeIRI . }
						OPTIONAL { ?tcn rdf:type welcome:DialogueUser . }
						OPTIONAL { ?tcn welcome:long ?longvalue . }
						OPTIONAL { ?tcn welcome:lat ?latvalue . }
						OPTIONAL { ?office rdf:type welcome:RegistrationOffice . }
						OPTIONAL { ?office ?proOffice ?valOffice . }
					}"""^^xsd:string ;
		]) .
		
:WriteCoordinatesinExecution
	a bt:Write ;
	rdfs:label "Write: TCN Address and Registration Office Coordinates in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>	
			PREFIX locn: <http://www.w3.org/ns/locn#>
			PREFIX daml: <http://www.daml.org/services/owl-s/1.1/ActorDefault.owl#>
			CONSTRUCT  {
				?tcn rdf:type welcome:DialogueUser .
				?tcn welcome:long ?longvalue .
				?tcn welcome:lat ?latvalue .
				?office rdf:type welcome:RegistrationOffice .
				?office locn:address ?address .
				?office daml:physicalAddress ?value .
				?office welcome:lat ?latval .
				?office welcome:long ?longval .		
			}
			WHERE {
				?tcn rdf:type welcome:DialogueUser .
				?tcn welcome:hasCity ?city .
				?city welcome:lat ?lat .
				?city welcome:long ?long .
				?office rdf:type welcome:RegistrationOffice .
				?office locn:address ?address .
				?address daml:physicalAddress ?value .
				?address welcome:lat ?lat ;
				?address welcome:long ?long .
			}"""^^xsd:string ;
	] .

:InvokeClosestDistancePlugin
	a welcomePlugin:ClosestLocation ;
	rdfs:label "Welcome Plugin:Calculate Closest Registration Office" ;
	welcomePlugin:tcnLocation [
			a bt:ConstructQuery ;
			bt:originBase ajan:ExecutionKnowledge ;
			bt:targetBase ajan:AgentKnowledge ;
			bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 						
					CONSTRUCT {
						?tcn rdf:type welcome:DialogueUser .
						?tcn welcome:long ?longvalue .
						?tcn welcome:lat ?latvalue .
					}
					WHERE { 
						?tcn rdf:type welcome:DialogueUser .
						?tcn welcome:long ?longvalue .
						?tcn welcome:lat ?latvalue .		
					}"""^^xsd:string ;
	] ;
	welcomePlugin:registrationOfficeLocation [
			a bt:ConstructQuery ;
			bt:originBase ajan:ExecutionKnowledge ;
			bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 						
					CONSTRUCT {
						?office rdf:type welcome:RegistrationOffice .
						?office locn:address ?address .
						?office daml:physicalAddress ?value .
						?office welcome:lat ?latval .
						?office welcome:long ?longval .	
					}
					WHERE { 
						?office rdf:type welcome:RegistrationOffice .
						?office locn:address ?address .
						?office daml:physicalAddress ?value .
						?office welcome:lat ?latval .
						?office welcome:long ?longval .				
					}"""^^xsd:string ;
	] .

:UpdateInformRegistrationServiceDIP
	a bt:Update ;
	rdfs:label "Update: Closest Office in Inform Registration Service DIP" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX actor: <http://www.daml.org/services/owl-s/1.1/ActorDefault.owl#> 
					PREFIX daml: <http://www.daml.org/services/owl-s/1.1/ActorDefault.owl#>
					PREFIX locn: <http://www.w3.org/ns/locn#>
					DELETE {
						welcomeServices:informOfficeAddress welcome:hasInputRDFContents ?RDFContents .
						?RDFContents ?proRDFContents ?valRDFContents .
					}
					INSERT{
						welcomeServices:informOfficeAddress welcome:hasInputRDFContents welcome:rdfInformClosestOffice .
						welcome:rdfInformClosestOffice a rdf:Statement .
						welcome:rdfInformClosestOffice rdf:subject ?officeIRI .
						welcome:rdfInformClosestOffice rdf:predicate actor:physicalAddress .
						welcome:rdfInformClosestOffice rdf:object ?value .
					}
					WHERE {	
						welcomeServices:InformRegistrationService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcomeServices:InformRegistrationService welcome:hasDIPStatus ?status .
						welcomeServices:InformRegistrationService welcome:isCurrentDIP "true"^^xsd:boolean .
						welcomeServices:InformRegistrationService welcome:hasSlot welcomeServices:informOfficeAddress .
						welcomeServices:informOfficeAddress welcome:hasInputRDFContents ?RDFContents .
						welcomeServices:informOfficeAddress ?prop ?propVal .
						?tcnIRI welcome:hasClosestRegistrationOffice ?officeIRI .
						?officeIRI locn:address ?address .
						?officeIRI daml:physicalAddress ?value .
						OPTIONAL {
							?RDFContents ?proRDFContents ?valRDFContents .
						}
					}"""^^xsd:string ;
		]) .

:ConditionalInformRegistrationServiceComplete
	a bt:Condition ;
	rdfs:label "Condition: Inform Registration Service Complete?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							welcomeServices:InformRegistrationService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							welcomeServices:InformRegistrationService welcome:DIPId ?id .	
					}"""^^xsd:string ;
		]) .
		
:EventProducerNormalClosingScenario
	a bt:EventProducer ;
	rdfs:label "EventProducer: Normal Closing Scenario" ;
	ajan:event agents:CloseScenarioEvent ;
	bt:content [
					a bt:ConstructQuery ;
					bt:originBase ajan:AgentKnowledge;
					bt:sparql """
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>
						CONSTRUCT {
							welcome:TCN_Profile welcome:updated "true" . 
						}
						WHERE {
							?s rdf:type ajan:Agent . 
						}"""^^xsd:string ;
				] .	

:ConditionalInformFirstReceptionServiceCompleteAndYesAnswer
	a bt:Condition ;
	rdfs:label "Condition: Inform First Reception DIP Complete? and Yes Answer" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>					
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							welcomeServices:InformFirstReceptionService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							welcomeServices:InformFirstReceptionService welcome:DIPId ?id .
							welcomeServices:InformFirstReceptionService welcome:hasSlot welcomeServices:obtainInterestRegistration .
							welcomeServices:obtainInterestRegistration welcome:hasTCNAnswer ?reifiedAnswer . 
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?ReifiSub .
							?reifiedAnswer rdf:predicate ?ReifiPredi .
							?reifiedAnswer rdf:object "Yes"  .
					}"""^^xsd:string ;
	]) .

:WritePersonalInfoDIP2Execution
	a bt:Write ;
	rdfs:label "Write: Personal Info DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>	
			CONSTRUCT  {
				welcomeServices:FillFormPersonalInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:FillFormPersonalInfo welcome:belongsTo ?service .
				welcomeServices:FillFormPersonalInfo welcome:hasDIPStatus ?status .
				welcomeServices:FillFormPersonalInfo welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:FillFormPersonalInfo welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .
				?slots welcome:hasTCNAnswer ?tcnAnswer .
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				?slots welcome:hasTemplateId ?templateID .
			}
			WHERE {
				welcomeServices:FillFormPersonalInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:FillFormPersonalInfo welcome:belongsTo ?service .
				welcomeServices:FillFormPersonalInfo welcome:hasDIPStatus ?status .
				welcomeServices:FillFormPersonalInfo welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:FillFormPersonalInfo welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .	
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
				FILTER NOT EXISTS
				{	
					GRAPH ?g {
						welcomeServices:FillFormPersonalInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcomeServices:FillFormPersonalInfo welcome:DIPId ?dipId .
						welcomeServices:FillFormPersonalInfo welcome:belongsTo ?service .
						welcomeServices:FillFormPersonalInfo welcome:hasDIPStatus ?status .
						welcomeServices:FillFormPersonalInfo welcome:isCurrentDIP "true"^^xsd:boolean .
						welcomeServices:FillFormPersonalInfo welcome:hasSlot ?slots .
						?slots rdf:type ?slotType .
						?slots welcome:hasOntologyType ?ontoType .
						?slots welcome:hasInputRDFContents ?RDFContents .	
						?slots welcome:hasStatus ?slotsStatus .		
						?slots welcome:hasNumberAttempts ?NbAttempts .
						?slots welcome:confidenceScore ?confScore .
						?slots welcome:isOptional ?optional .	
						OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
					}
					FILTER regex(str(?g), "DIP") 
				}
			}"""^^xsd:string ;
	] .
	
:ConditionalPersonalInfoComplete
	a bt:Condition ;
	rdfs:label "Condition: Personal Info DIP Complete?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>					
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							welcomeServices:FillFormPersonalInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							welcomeServices:FillFormPersonalInfo welcome:DIPId ?id .
					}"""^^xsd:string ;
	]) .
	
:WriteAddressInfoDIP2Execution
	a bt:Write ;
	rdfs:label "Write: Address Info DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>	
			CONSTRUCT  {
				welcomeServices:FillFormAddressInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:FillFormAddressInfo welcome:belongsTo ?service .
				welcomeServices:FillFormAddressInfo welcome:hasDIPStatus ?status .
				welcomeServices:FillFormAddressInfo welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:FillFormAddressInfo welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .
				?slots welcome:hasTCNAnswer ?tcnAnswer .
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				?slots welcome:hasTemplateId ?templateID .
			}
			WHERE {
				welcomeServices:FillFormAddressInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:FillFormAddressInfo welcome:belongsTo ?service .
				welcomeServices:FillFormAddressInfo welcome:hasDIPStatus ?status .
				welcomeServices:FillFormAddressInfo welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:FillFormAddressInfo welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .	
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
				FILTER NOT EXISTS
				{	
					GRAPH ?g {
						welcomeServices:FillFormAddressInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcomeServices:FillFormAddressInfo welcome:DIPId ?dipId .
						welcomeServices:FillFormAddressInfo welcome:belongsTo ?service .
						welcomeServices:FillFormAddressInfo welcome:hasDIPStatus ?status .
						welcomeServices:FillFormAddressInfo welcome:isCurrentDIP "true"^^xsd:boolean .
						welcomeServices:FillFormAddressInfo welcome:hasSlot ?slots .
						?slots rdf:type ?slotType .
						?slots welcome:hasOntologyType ?ontoType .
						?slots welcome:hasInputRDFContents ?RDFContents .	
						?slots welcome:hasStatus ?slotsStatus .		
						?slots welcome:hasNumberAttempts ?NbAttempts .
						?slots welcome:confidenceScore ?confScore .
						?slots welcome:isOptional ?optional .	
						OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
					}
					FILTER regex(str(?g), "DIP") 
				}
			}"""^^xsd:string ;
	] .

:ConditionalAddressInfoDIPComplete
	a bt:Condition ;
	rdfs:label "Condition: Address Info DIP Complete?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>					
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							welcomeServices:FillFormAddressInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							welcomeServices:FillFormAddressInfo welcome:DIPId ?id .
					}"""^^xsd:string ;
	]) .

:WriteFillFormOtherDIP2Execution
	a bt:Write ;
	rdfs:label "Write: Fill Form Other Info DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>				
			CONSTRUCT  {
				welcomeServices:FillFormOther rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:FillFormOther welcome:belongsTo ?service .
				welcomeServices:FillFormOther welcome:hasDIPStatus ?status .
				welcomeServices:FillFormOther welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:FillFormOther welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .
				?slots welcome:hasTCNAnswer ?tcnAnswer .
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				?slots welcome:hasTemplateId ?templateID .
			}
			WHERE {
				welcomeServices:FillFormOther rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:FillFormOther welcome:belongsTo ?service .
				welcomeServices:FillFormOther welcome:hasDIPStatus ?status .
				welcomeServices:FillFormOther welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:FillFormOther welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .	
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
				FILTER NOT EXISTS
				{	
					GRAPH ?g {
						welcomeServices:FillFormOther rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcomeServices:FillFormOther welcome:DIPId ?dipId .
						welcomeServices:FillFormOther welcome:belongsTo ?service .
						welcomeServices:FillFormOther welcome:hasDIPStatus ?status .
						welcomeServices:FillFormOther welcome:isCurrentDIP "true"^^xsd:boolean .
						welcomeServices:FillFormOther welcome:hasSlot ?slots .
						?slots rdf:type ?slotType .
						?slots welcome:hasOntologyType ?ontoType .
						?slots welcome:hasInputRDFContents ?RDFContents .	
						?slots welcome:hasStatus ?slotsStatus .		
						?slots welcome:hasNumberAttempts ?NbAttempts .
						?slots welcome:confidenceScore ?confScore .
						?slots welcome:isOptional ?optional .	
						OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
					}
					FILTER regex(str(?g), "DIP") 
				}
			}"""^^xsd:string ;
	] .

:ConditionalFillFormOtherDIPComplete
	a bt:Condition ;
	rdfs:label "Condition: Other Info DIP Complete?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>					
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							welcomeServices:FillFormOther rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							welcomeServices:FillFormOther welcome:DIPId ?id .
					}"""^^xsd:string ;
	]) .
	
:WriteFillFormModulesDIP2Execution
	a bt:Write ;
	rdfs:label "Write: Fill Form Modules DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>	
			CONSTRUCT  {
				welcomeServices:FillFormModules rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:FillFormModules welcome:belongsTo ?service .
				welcomeServices:FillFormModules welcome:hasDIPStatus ?status .
				welcomeServices:FillFormModules welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:FillFormModules welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .
				?slots welcome:hasTCNAnswer ?tcnAnswer .
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				?slots welcome:hasTemplateId ?templateID .
			}
			WHERE {
				welcomeServices:FillFormModules rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:FillFormModules welcome:belongsTo ?service .
				welcomeServices:FillFormModules welcome:hasDIPStatus ?status .
				welcomeServices:FillFormModules welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:FillFormModules welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .	
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
				FILTER NOT EXISTS
				{	
					GRAPH ?g {
						welcomeServices:FillFormModules rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcomeServices:FillFormModules welcome:DIPId ?dipId .
						welcomeServices:FillFormModules welcome:belongsTo ?service .
						welcomeServices:FillFormModules welcome:hasDIPStatus ?status .
						welcomeServices:FillFormModules welcome:isCurrentDIP "true"^^xsd:boolean .
						welcomeServices:FillFormModules welcome:hasSlot ?slots .
						?slots rdf:type ?slotType .
						?slots welcome:hasOntologyType ?ontoType .
						?slots welcome:hasInputRDFContents ?RDFContents .	
						?slots welcome:hasStatus ?slotsStatus .		
						?slots welcome:hasNumberAttempts ?NbAttempts .
						?slots welcome:confidenceScore ?confScore .
						?slots welcome:isOptional ?optional .	
						OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
					}
					FILTER regex(str(?g), "DIP") 
				}
			}"""^^xsd:string ;
	] .
	
:ConditionalFillFormModulesDIPComplete
	a bt:Condition ;
	rdfs:label "Condition: Fill Form Modules DIP Complete?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>					
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							welcomeServices:FillFormModules rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							welcomeServices:FillFormModules welcome:DIPId ?id .
					}"""^^xsd:string ;
	]) .
	
:WriteFillFormCourseDIP2Execution
	a bt:Write ;
	rdfs:label "Write: Fill Course Info DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>	
			CONSTRUCT  {
				welcomeServices:FillFormCourse rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:FillFormCourse welcome:belongsTo ?service .
				welcomeServices:FillFormCourse welcome:hasDIPStatus ?status .
				welcomeServices:FillFormCourse welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:FillFormCourse welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .
				?slots welcome:hasTCNAnswer ?tcnAnswer .
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				?slots welcome:hasTemplateId ?templateID .
			}
			WHERE {
				welcomeServices:FillFormCourse rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
				welcomeServices:FillFormCourse welcome:belongsTo ?service .
				welcomeServices:FillFormCourse welcome:hasDIPStatus ?status .
				welcomeServices:FillFormCourse welcome:isCurrentDIP "true"^^xsd:boolean .
				welcomeServices:FillFormCourse welcome:hasSlot ?slots .
				?slots rdf:type ?slotType .
				?slots welcome:hasOntologyType ?ontoType .
				?slots welcome:hasInputRDFContents ?RDFContents .	
				?slots welcome:hasStatus ?slotsStatus .		
				?slots welcome:hasNumberAttempts ?NbAttempts .
				?slots welcome:confidenceScore ?confScore .
				?slots welcome:isOptional ?optional .	
				OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
				FILTER NOT EXISTS
				{	
					GRAPH ?g {
						welcomeServices:FillFormCourse rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcomeServices:FillFormCourse welcome:DIPId ?dipId .
						welcomeServices:FillFormCourse welcome:belongsTo ?service .
						welcomeServices:FillFormCourse welcome:hasDIPStatus ?status .
						welcomeServices:FillFormCourse welcome:isCurrentDIP "true"^^xsd:boolean .
						welcomeServices:FillFormCourse welcome:hasSlot ?slots .
						?slots rdf:type ?slotType .
						?slots welcome:hasOntologyType ?ontoType .
						?slots welcome:hasInputRDFContents ?RDFContents .	
						?slots welcome:hasStatus ?slotsStatus .		
						?slots welcome:hasNumberAttempts ?NbAttempts .
						?slots welcome:confidenceScore ?confScore .
						?slots welcome:isOptional ?optional .	
						OPTIONAL {						
							{?slots welcome:hasTemplateId ?templateID .}
							UNION
							{?slots welcome:hasTCNAnswer ?tcnAnswer .}				
						}
					}
					FILTER regex(str(?g), "DIP") 
				}
			}"""^^xsd:string ;
	] .
	
:ConditionalFillFormCourseDIPComplete
	a bt:Condition ;
	rdfs:label "Condition: Fill Form Course DIP Complete?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>					
					PREFIX welcomeServices: <http://localhost:8080/services/FirstReceptionService.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							welcomeServices:FillFormCourse rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							welcomeServices:FillFormCourse welcome:DIPId ?id .
					}"""^^xsd:string ;
	]) .

:UpdateCreateHeaderAppNotificationMessage
	a bt:Update ;
	rdfs:label "Update: Header App Notification Message" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					INSERT {
						welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
						welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
						welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
						welcome:headerUserID welcome:hasHeaderValue ?id .						
					} 
					WHERE { 
						?message welcome:hasCorrelationID ?correlationID .
						?du rdf:type welcome:DialogueUser .
						?du welcome:hasUserId ?id .
					}
					"""^^xsd:string ;
		]) .
		
:SendNotification2App
	a bt:Message ;
	rdfs:label "Message: Send Notification to App to Retrieve Content"^^xsd:string ;
	rdfs:comment "Message: Send Notification to App to Retrieve Content"^^xsd:string ;
	bt:targetBase ajan:AgentKnowledge ;  
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
		  a bt:SelectQuery;
		  a bt:QueryUri ;
		  bt:originBase ajan:AgentKnowledge ;
		  bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					SELECT ?hdrName ?fieldValue
					WHERE {
						{
							?headerName welcome:hasHeaderName ?hdrName .
							?headerName welcome:hasHeaderValue ?fieldValue .
						}
						UNION 
						{
							  VALUES (?hdrName ?fieldValue) {							
								("content-type" "application/ld+json")							
								("Accept" "application/ld+json")
							}
						}
					}"""^^xsd:string
		] ;
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "application/ld+json"^^xsd:string 
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "application/ld+json"
				]
		) ;	
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:AgentKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>
						CONSTRUCT {
							welcome:app welcome:retrieveFormContent "true" .
						}
						WHERE {
							?s rdf:type ajan:Agent .
						}"""^^xsd:string
			]
		] ;    
	] ;
	bt:queryUri [
		a bt:SelectQuery ;
		a bt:QueryUri ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					SELECT ?requestURI
					WHERE {
					  VALUES ?requestURI { "http://18.224.42.120:9998/welcome/integration/workflow/dispatcher/agentNotification" }
					}"""^^xsd:string
	] .
#	bt:queryUri [
#		a bt:SelectQuery ;
#		a bt:QueryUri ;
#		bt:originBase ajan:AgentKnowledge ;
#		bt:sparql """
#					SELECT ?requestURI
#					WHERE {
#					  VALUES ?requestURI {"http://localhost:8092/dms/receiveDIP"}
#					}"""^^xsd:string
#	] .
	
:DeleteHeaderAppNotificationMessage
	a bt:Update ;
	rdfs:label "Update: Header App Notification Message" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					DELETE {
						welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
						welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
						welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
						welcome:headerUserID welcome:hasHeaderValue ?userID .	
						welcome:app welcome:retrieveFormContent "true" .
					} 
					WHERE { 
						welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
						welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
						welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
						welcome:headerUserID welcome:hasHeaderValue ?userID .	
						OPTIONAL{ welcome:app welcome:retrieveFormContent "true" }
					}
					"""^^xsd:string ;
		]) .
		
#=============================================================================================
# ShutdownBTBehavior

:EventHandlerShutdown
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Shutdown Request" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#AgentShutdownEvent> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:AgentKnowledge ;
					bt:sparql """
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							?s ?p ?o .
						}
						WHERE { 
							?s ?p ?o . 			
						} 
					"""^^xsd:string ;
				] .

:ConditionAgentRunningBT
	a bt:Condition ;
	rdfs:label "Condition: Agent Runs a BT? " ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>
					ASK
					WHERE {
						?agent welcome:hasBTRunning "true"^^xsd:boolean .
						?agent rdf:type ajan:Agent .							
					}"""^^xsd:string ;
		]) .
		
:UpdateAgentRunningYes
	a bt:Update ;
	rdfs:label "Update: Not Kill the Agent" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					DELETE {
						?agent welcome:canBeKilled ?previousVal .
					}
					INSERT {
						?agent welcome:canBeKilled "false"^^xsd:boolean .
					}
					WHERE {
						?agent rdf:type ajan:Agent .
						OPTIONAL {
							?agent welcome:canBeKilled ?previousVal .
						}
					}					
					"""^^xsd:string ;
		]) .

:UpdateAgentRunningNot
	a bt:Update ;
	rdfs:label "Update: Kill the Agent" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					DELETE {
						?agent welcome:canBeKilled ?previousVal .
					}
					INSERT {
						?agent welcome:canBeKilled "true"^^xsd:boolean .
					}
					WHERE {
						?agent rdf:type ajan:Agent .
						OPTIONAL {
							?agent welcome:canBeKilled ?previousVal .
						}
					}					
					"""^^xsd:string ;
		]) .

:MessageSendShutdownNotification
	a bt:Message ;
	rdfs:label "Message: Send Shutdown Notification to WPM"^^xsd:string ;
	rdfs:comment "Message: Send Shutdown Notification to WPM"^^xsd:string ;
	bt:targetBase ajan:AgentKnowledge ;  
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
			a bt:SelectQuery;
			a bt:QueryUri ;
			bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?hdrName ?userID
				WHERE {
					   VALUES ?hdrName {"X-User-ID"}
					   ?du rdf:type welcome:DialogueUser .
					   ?du welcome:hasUserId ?userID .
				}"""^^xsd:string
		] ;
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "text/turtle; charset=UTF-8"^^xsd:string 
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "application/ld+json"
				][
					a http-core:Header ;
					http-core:hdrName http-headers:to ;
					http-core:fieldValue "WPM"
			]
		) ;	
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:AgentKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							?agent welcome:canBeKilled ?val .
						}
						WHERE {
							?agent welcome:canBeKilled ?val .
						}"""^^xsd:string
			]
		] ;    
	] ;
	bt:queryUri [
		a bt:SelectQuery ;
		a bt:QueryUri ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					SELECT ?requestURI
					WHERE {
					  VALUES ?requestURI { "/welcome/integration/workflow/dispatcher/agentShutdownAcknowledgement" }
					}"""^^xsd:string
	] .
#	bt:queryUri [
#		a bt:SelectQuery ;
#		a bt:QueryUri ;
#		bt:originBase ajan:AgentKnowledge ;
#		bt:sparql """
#					SELECT ?requestURI
#					WHERE {
#					  VALUES ?requestURI { "http://localhost:8092/dms/receiveDIP" }
#					}"""^^xsd:string
#	] .
